import{a6 as re,d as oe,r as t,j as e,ao as ae,a7 as j,ap as X,aq as ie,a9 as le,B as P,ar as Z,S as J,P as O,c as ce,as as de,ah as ue,a8 as me,al as he,an as E,ac as ee,ad as C,at as pe,au as xe,av as je,aw as ge}from"./vendor-WQejLG7Y.js";import{c as fe,n as M,d as Q,g as ye}from"./index-BUY2Cjej.js";import{b as ke}from"./bank.service-B_Z2xVIm.js";import{p as te}from"./pool.service-DXigxJcB.js";import{g as ve,a as Ce,b as we,c as Se}from"./index-YDRpzjTi.js";import{u as Te}from"./fetchList-Dx9pDj27.js";import{g as Ae}from"./contractUtils-DBsZcc68.js";import{M as be}from"./myDocumentsModal-_TegKspg.js";import"./pdf-DFr8ztBQ.js";import"./app-q0ws3Yx0.js";import"./attachment.service-CbFqwko5.js";function se({isOpen:h,onClose:T,pool:u,event:n,isJunior:c}){var x,R;const{message:z}=re.useApp(),{address:w,connector:A,isConnected:$}=oe(),W=fe();console.log({address:w,connector:A,isConnected:$,currentChain:W});const[g,v]=t.useState(0),[b,V]=t.useState(0),[r,B]=t.useState([0,0]),[U,_]=t.useState("-"),[F,I]=t.useState("-"),[S,q]=t.useState(0),[L,f]=t.useState(!1),[p,G]=t.useState(18),H=t.useCallback(async(o,i)=>{const l=await ve(c?i.juniorNotesTokenAddress:i.notesTokenAddress),d=async y=>{let k=[];try{k=await Promise.all([l.call("balanceOf",[y]),l.call("decimals")])}catch(ne){return console.log("e",{e:ne}),0}const{[0]:K,[1]:N}=k;return G(N),parseFloat(Z(K.toString(),N.toString()))};try{const y=await d(w),k=await Ae({event:i,pool:o});B(k);const K=c?k[1]:k[0],N=y*K;_(y),I(N),q(N)}catch(y){console.log(y)}},[w,c,r]),D=w,Y=async()=>{if(!D)return;f(!0);const o=c?n.juniorNotesTokenAddress:n.notesTokenAddress,i=await we(Q.contracts.DistributionOperator);console.log("distributionOperatorContract",i);try{const l=c?r[1]:r[0],d=new J(g).div(l).multipliedBy(10**p).toFixed(0);await i.send("makeRedeemRequestAndRedeem",[u.poolContractAddress,o,d]),f(!1),T(),v(0),window.location.reload(!1)}catch(l){console.log(l),z.error("Failed to approve transaction"),f(!1)}};t.useEffect(()=>{u&&h&&n&&H(u,n).catch(console.log)},[u,h,n]);const s=n?c?"JOT":"SOT":"",m=async()=>{try{if(!D)return;f(!0);const o=c?n.juniorNotesTokenAddress:n.notesTokenAddress,i=await Ce(o),l=c?r[1]:r[0],d=new J(g).div(l).multipliedBy(10**p).toFixed(0);console.log(Q.contracts.DistributionTranche),await i.send("approve",[Q.contracts.DistributionTranche,d]),V(1),f(!1)}catch(o){console.log(o),z.error("Failed to approve transaction"),f(!1)}},a=c?r[1]:r[0];return e.jsx(ae,{width:"100vw",title:"Withdraw",open:h,onCancel:()=>{T(),v(0)},footer:null,children:!!u&&e.jsx("div",{children:e.jsxs(j,{layout:"vertical",children:[e.jsxs(X,{current:b,size:"small",progressDot:!0,children:[e.jsx(X.Step,{title:"Set Amount"}),e.jsx(X.Step,{title:"Withdraw"})]}),b===0&&e.jsxs(e.Fragment,{children:[e.jsx(j.Item,{label:"Payment Amount",children:e.jsxs(ie.Compact,{children:[e.jsx(le,{placeholder:"0",type:"number",value:g,onChange:o=>{console.log(+o.target.value),v(Math.min(+o.target.value,S))}}),e.jsx(P,{type:"primary",onClick:()=>v(S),children:"MAX"})]})}),e.jsx(j.Item,{label:"Token amount",children:e.jsxs("div",{children:[s," ",U]})}),e.jsx(j.Item,{label:"Token price",children:e.jsx("div",{children:r.length>0?c?M(n.status===1?1:r[1]):M(r[0]):"-"})}),e.jsx(j.Item,{label:"Currency amount",children:e.jsx("div",{children:F})}),e.jsx(j.Item,{children:e.jsx(P,{disabled:g<=0||!D,type:"primary",loading:L,onClick:m,children:"Next"})})]}),b===1&&e.jsxs(e.Fragment,{children:[e.jsx(j.Item,{label:"Amount to withdraw",children:e.jsxs("div",{children:[n&&((R=(x=n==null?void 0:n.pool)==null?void 0:x.currency)==null?void 0:R.tokenSymbol),": ",g]})}),e.jsx(j.Item,{label:"Equivalent token amount",children:e.jsx("div",{children:a&&g/a})}),e.jsx(j.Item,{children:e.jsx(P,{loading:L,type:"primary",onClick:()=>Y(),children:"Withdraw"})})]})]})})})}se.propTypes={isOpen:O.bool,onClose:O.func,pool:O.object,event:O.object,isJunior:O.bool};const ze=()=>{const{address:h}=oe(),T=ce(),[u,n]=Te(te.getEventsByInvestor),[c,z]=t.useState(null),[w,A]=t.useState(-1),[$,W]=t.useState(!1),[g,v]=t.useState(null),[b,V]=t.useState(null),[r,B]=t.useState(null),[U,_]=t.useState(!1),[F,I]=t.useState(!1),[S,q]=t.useState(null),[L,f]=t.useState([]);t.useEffect(()=>{ke.getLinkedWallet().then(({walletAddress:s})=>{B(de(s))})},[]);const p=t.useMemo(()=>r&&h?r.toLowerCase()==h.toLowerCase():!1,[h,r]),G=async s=>{const m=h;try{const a=await te.getPortfolioDetail(m),x=await Promise.all(a==null?void 0:a.investments.map(async o=>{const i=await Se(o.tgeAddress);let l="0";try{const d=await i.methods.getTokenPrice().call();l=Z(d||0,o.tokenDecimals)}catch(d){console.log("error get contract price",d)}return l})),R=a==null?void 0:a.investments.map((o,i)=>{const l=ge(s,k=>k.poolId===o.poolId),d=Z(o.amount,o.tokenDecimals),y=parseFloat(x[i])*d;return{poolName:o.poolName,poolType:o.tokenName,total:d,price:x[i],token:y,tgeAddress:o.tgeAddress,id:o.poolId,event:l}});f(R)}catch(a){console.log("get porfolio issues: ",a)}};t.useEffect(()=>{u.length&&p&&G(u)},[u,h,p]);const H=!n&&u.length===0,D=ye(ue(c,"shortCode","")),Y=(s,m)=>{const a=[{key:"1",children:"View details",onClick:()=>T(`/note/${s.id}?junior=${m}`)},{key:"withdraw",children:"Withdraw",onClick:()=>{W(!0),v(s.pool),A(null),V(s),_(m)}},{key:"document",children:"View Document",onClick:()=>{console.log(s),A(-1),I(!0),q(s)}}];return e.jsx("div",{children:a.map(x=>e.jsx("div",{onClick:x.onClick,children:x.children},x.key))})};return e.jsxs("div",{id:"profil-form-container",children:[p==!1&&e.jsx("div",{children:e.jsx(me,{message:e.jsxs("span",{children:["Switch to linked wallet ",r," to continue"]}),type:"info",showIcon:!0})}),e.jsx("div",{children:e.jsx("div",{style:{width:780,textAlign:"left"},children:e.jsx("br",{})})}),e.jsxs("div",{style:{textAlign:"left",color:"#1f244e",marginTop:50},children:["My Investments",e.jsx(he,{style:{height:2}})]}),n?e.jsx(E,{active:!0}):H?e.jsx("div",{children:e.jsxs(ee,{children:[e.jsx(C,{xs:24,md:8,children:e.jsx("div",{children:"You currently have no investments"})}),e.jsx(C,{xs:24,md:8,children:e.jsx("div",{style:{textAlign:"justify",marginLeft:20},children:"Untangled platform is currently offering a diverse set of opportunities with attractive target annual returns."})}),e.jsx(C,{xs:24,md:8,children:e.jsx("div",{children:e.jsx(P,{onClick:()=>T("/invest"),type:"primary",children:"VIEW OFFERINGS"})})})]})}):e.jsx("div",{id:"pool-container",style:{marginTop:50,height:"calc(100vh - 160px)",minHeight:500,overflowY:"auto"},children:e.jsx("center",{children:n?e.jsx(E,{active:!0}):e.jsx(e.Fragment,{children:L.map((s,m)=>e.jsxs("div",{children:[e.jsx(pe,{content:Y(s.event,s.tokenName==="JOT"),trigger:"click",placement:"rightTop",open:w===`junior${m}`,onOpenChange:a=>A(a?`junior${m}`:-1),children:e.jsx(P,{style:{position:"absolute",top:5,right:5},icon:e.jsx(xe,{}),size:"small"})}),e.jsxs(ee,{gutter:[16,16],style:{width:"100%"},children:[e.jsx(C,{xs:24,md:9,children:e.jsx("div",{style:{textAlign:"left",color:"#1f244e",fontSize:16,marginRight:10},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:s.poolName}),e.jsx(je,{color:"blue",children:s.tokenName==="JOT"?"Junior":"Senior"})]})})}),e.jsx(C,{xs:8,md:5,children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12},children:["TOTAL ",s.tokenName==="JOT"?"JOT":"SOT"," INVESTED"]}),e.jsx("div",{style:{marginTop:10,fontSize:14},children:p?`${M(s.total||0)}`:e.jsx(E,{active:!0,loading:!0})})]})}),e.jsx(C,{xs:8,md:5,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12},children:"CURRENT PRICE"}),e.jsx("div",{style:{marginTop:10,fontSize:14},children:p?`${M(s.price)}`:e.jsx(E,{active:!0,loading:!0})})]})}),e.jsx(C,{xs:8,md:5,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12},children:"CURRENT TOKEN VALUE"}),e.jsx("div",{style:{marginTop:10,fontSize:14},children:p?`${D} ${M(s.token)}`:e.jsx(E,{active:!0,loading:!0})})]})})]})]},`junior${m}`))})})}),e.jsx(se,{isOpen:$,onClose:()=>{W(!1),v(null)},pool:g,event:b,isJunior:U}),F&&S&&e.jsx(be,{poolId:S.pool.id,showModal:()=>I(!0),visible:F,onClose:()=>I(!1),disableCreateNew:!0,preSelectedDocumentId:S.legalDocumentId})]})};export{ze as default};
