import{r as u,aQ as N,aF as O,j as e,ao as I,ah as G,ad as r,a9 as T,aJ as f,al as R,B as b,ai as z,aY as E,a7 as M,aD as F,Y as k,k as B}from"./vendor-WQejLG7Y.js";const L=({isOpen:x,defaultDiscountRate:o,isEditing:m,handleSwitchToEdit:D,closeScorecardModal:c,handleCreateNew:h,selectedScorecard:n})=>{const[t,l]=u.useState({updatedAt:new Date,discountRate:o}),[v,p]=u.useState(!1);u.useEffect(()=>{p(!1),l(n||{updatedAt:new Date,discountRate:o})},[m,n]);const g=u.useMemo(()=>{const i=[];return["name","daysPastDue","advanceRate","interestRate","discountRate","penaltyRate","gracePeriod","collectionPeriod","writeOffAfterGracePeriod","writeOffAfterCollectionPeriod","probabilityOfDefault","lossGivenDefault"].forEach(s=>{N(t[s])&&i.push(s)}),!O(i)},[t]),y=u.useCallback(async()=>{p(!0),h(t,()=>p(!1))},[h,t]),a=u.useMemo(()=>!!(!m&&n),[m,n]),w={header:{backgroundColor:"transparent"},content:{borderRadius:24,backgroundColor:"#F0F0F0"}};return e.jsxs(I,{title:a?"Risk score Info":n?"Update risk score":"Add risk score",open:x,styles:w,onCancel:c,footer:a?[G(n,"isNewest",!1)&&e.jsx(b,{type:"primary",disabled:g,onClick:D,children:"Update"},"submit")]:[e.jsx(b,{className:"shadow-none border-none h-11 w-[5.6rem] bg-[#25272614] hover:bg-[#25272614]",onClick:c,style:{background:"#25272614"},children:"Cancel"},"back"),e.jsx(b,{loading:v,size:"middle",style:{width:90,height:44},className:"shadow-none",type:"primary",disabled:g,onClick:y,children:"Save"},"submit")],children:[e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Risk Score"}),e.jsx("div",{children:a||m?n.name:e.jsx(T,{disabled:a,id:"RiskScore",autoComplete:"off",maxLength:5,placeholder:"Risk Score",size:"middle",value:t.name,onChange:i=>l({...t,name:i.target.value})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Days past due"}),e.jsx("div",{children:a?n.daysPastDue:e.jsx(f,{disabled:a,className:"w-full",id:"RiskScore",precision:0,min:0,suffix:"days",autoComplete:"off",placeholder:"Days past due",size:"middle",value:t.daysPastDue,onChange:i=>l({...t,daysPastDue:i})})})]}),e.jsx(R,{}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Advance rate"}),e.jsx("div",{children:a?n.advanceRate:e.jsx(f,{disabled:a,id:"AdvanceRate",className:"w-full",autoComplete:"off",precision:2,suffix:"%",min:0,max:100,placeholder:"Advance rate",size:"middle",value:t.advanceRate,onChange:i=>l({...t,advanceRate:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Interest rate"}),e.jsx("div",{children:a?n.interestRate:e.jsx(f,{disabled:a,id:"InterestRate",className:"w-full",autoComplete:"off",precision:2,suffix:"%",min:0,placeholder:"Interest rate",size:"middle",value:t.interestRate,onChange:i=>l({...t,interestRate:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},className:"hidden",children:[e.jsx("div",{children:"Discount rate"}),e.jsx("div",{children:a?n.discountRate:e.jsx(f,{disabled:!0,id:"InterestRate",autoComplete:"off",placeholder:"Discount rate",precision:2,suffix:"%",min:0,size:"middle",value:t.discountRate})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Penalty rate"}),e.jsx("div",{children:a?n.penaltyRate:e.jsx(f,{className:"w-full",disabled:a,id:"PenaltyRate",autoComplete:"off",placeholder:"Penalty rate",precision:2,suffix:"%",min:0,size:"middle",value:t.penaltyRate,onChange:i=>l({...t,penaltyRate:i})})})]}),e.jsx(R,{}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Grace period"}),e.jsx("div",{children:a?n.gracePeriod:e.jsx(f,{className:"w-full",disabled:a,id:"GracePeriod",min:0,precision:0,autoComplete:"off",placeholder:"Grace period",suffix:"days",size:"middle",value:t.gracePeriod,onChange:i=>l({...t,gracePeriod:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Collection Period"}),e.jsx("div",{children:a?n.collectionPeriod:e.jsx(f,{min:0,className:"w-full",disabled:a,id:"CollectionPeriod",autoComplete:"off",suffix:"days",precision:0,size:"middle",placeholder:"Collection Period",value:t.collectionPeriod,onChange:i=>l({...t,collectionPeriod:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Write off after grace period"}),e.jsx("div",{children:a?n.writeOffAfterGracePeriod:e.jsx(f,{disabled:a,id:"WriteOffAfterGracePeriod",className:"w-full",autoComplete:"off",precision:2,min:0,max:100,suffix:"%",placeholder:"Write off after grace period",size:"middle",value:t.writeOffAfterGracePeriod,onChange:i=>l({...t,writeOffAfterGracePeriod:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Write off after collection period"}),e.jsx("div",{children:a?n.writeOffAfterCollectionPeriod:e.jsx(f,{disabled:a,className:"w-full",min:0,max:100,precision:2,id:"WriteOffAfterCollectionPeriod",autoComplete:"off",suffix:"%",placeholder:"Write off after collection period",size:"middle",value:t.writeOffAfterCollectionPeriod,onChange:i=>l({...t,writeOffAfterCollectionPeriod:i})})})]}),e.jsx(R,{}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Probability of Default (Annual)"}),e.jsx("div",{children:a?n.probabilityOfDefault:e.jsx(f,{disabled:a,className:"w-full",min:0,max:100,placeholder:"Probability of default",precision:2,id:"probabilityOfDefault",autoComplete:"off",suffix:"%",size:"middle",value:t.probabilityOfDefault,onChange:i=>l({...t,probabilityOfDefault:i})})})]}),e.jsxs(r,{style:{marginTop:a?0:10},children:[e.jsx("div",{children:"Loss Given Default"}),e.jsx("div",{children:a?n.lossGivenDefault:e.jsx(f,{className:"w-full",disabled:a,id:"LossGivenDefault",min:0,max:100,autoComplete:"off",suffix:"%",precision:2,placeholder:"Loss given default",size:"middle",value:t.lossGivenDefault,onChange:i=>l({...t,lossGivenDefault:i})})})]})]})},Y=({editable:x=!1,scorecards:o,setScorecards:m,isLoading:D})=>{const[c,h]=u.useState({isOpen:!1,isEditing:!1,selectedScorecard:void 0}),[n,t]=u.useState(null),[l,v]=u.useState(0);u.useEffect(()=>{var i,s;o.length&&((i=o==null?void 0:o[0])!=null&&i.discountRate)&&v((s=o==null?void 0:o[0])==null?void 0:s.discountRate)},[o]),u.useEffect(()=>{m(i=>i.map(s=>({...s,discountRate:l})))},[l]);const p=i=>{m(s=>s.filter(d=>d.id!==i))},g=u.useMemo(()=>[{fixed:"left",title:"Date",dataIndex:"updatedAt",key:"updatedAt",width:110,render:i=>z(i).format("DD/MM/YYYY")},{fixed:"left",title:"Risk score",width:80,dataIndex:"name",key:"name"},{title:"Days past due",fixed:"left",dataIndex:"daysPastDue",key:"daysPastDue",render:(i,s,d)=>d===o.length-1?`>=${i}`:`${i} - <${o[d+1].daysPastDue}`},{title:"Advance rate (%)",dataIndex:"advanceRate",align:"right",key:"advanceRate"},{title:"Interest rate (%)",dataIndex:"interestRate",align:"right",key:"interestRate"},{title:"Annual probability of default (%)",dataIndex:"probabilityOfDefault",align:"right",key:"probabilityOfDefault"},{title:"Loss Given Default (%)",dataIndex:"lossGivenDefault",align:"right",key:"lossGivenDefault"},{title:"Write off after collection period (%)",dataIndex:"writeOffAfterCollectionPeriod",fixed:"right",align:"right",width:200,key:"writeOffAfterCollectionPeriod",render:(i,s)=>x&&n===s.id?e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-min flex justify-between gap-6 bg-[#CECFCF] rounded-md px-4 py-2 my-0",children:[e.jsx("a",{onClick:()=>y(!0,s),className:"rounded-sm shadow-none font-semibold text-[#117B37]",type:"primary",children:"Update"}),e.jsx(E,{overlayClassName:"!w-36",onConfirm:()=>p(s.id),title:"Are you sure want to delete?",okText:"OK",cancelText:"Cancel",icon:null,okButtonProps:{shape:"round",className:"shadow-none border-none !font-medium"},arrow:!1,placement:"top",cancelButtonProps:{shape:"round",className:"shadow-none font-normal !font-medium",style:{backgroundColor:"#25272614"}},children:e.jsx("a",{className:"font-semibold text-[#CB3A3A] hover:text-[#CB3A3A]",children:"Delete"})})]})}):i}].filter(Boolean),[n,x,p,o]),y=(i,s)=>{h({...c,isOpen:!0,isEditing:i,selectedScorecard:s})},a=()=>{h({...c,isOpen:!1})},w=async(i,s)=>{if(o.find(d=>d.daysPastDue==i.daysPastDue&&d.name!=i.name)){k.error("Days past due already exists"),s&&s();return}if(c.isEditing)m(d=>B(d,j=>{const C=j.findIndex(({id:P})=>i.id===P);if(C===-1)throw new Error("Edit a scorecard but can't find it");j[C]=i,j.sort((P,A)=>P.daysPastDue-A.daysPastDue)}));else{if(o.find(d=>d.name==i.name)){k.error("Risk score already exists"),s&&s();return}m(d=>[...d,{...i,id:Date.now()}].sort((j,C)=>j.daysPastDue-C.daysPastDue))}s&&s(),a()};return e.jsxs("div",{className:"flex flex-col items-stretch",children:[e.jsxs("div",{className:"flex flex-row justify-between align-center",children:[e.jsx(M.Item,{label:"Discount rate",labelCol:{span:24},wrapperCol:{span:16},children:e.jsx(f,{type:"input-number-v2",className:"w-full",min:0,precision:2,max:100,placeholder:"Enter discount rate",id:"minFirstLossCushion",suffix:"%",value:l,onChange:i=>v(i)})}),e.jsx("div",{className:"self-center",children:x?e.jsx(b,{type:"primary",onClick:()=>y(!1),style:{background:"#25272614"},className:"shadow-none h-10",size:"middle",shape:"round",children:"Add a risk score"}):!1})]}),e.jsxs("div",{children:[e.jsx(F,{scroll:{x:1100},pagination:!1,loading:D,dataSource:o.map(i=>({...i,key:i.daysPastDue})),columns:g,onRow:i=>({onMouseEnter:()=>t(i.id),onMouseLeave:()=>t(null)})}),c.isOpen&&e.jsx(L,{defaultDiscountRate:l,handleCreateNew:w,...c,closeScorecardModal:a,handleSwitchToEdit:()=>y(!0,c.selectedScorecard)})]})]})};export{Y as S};
