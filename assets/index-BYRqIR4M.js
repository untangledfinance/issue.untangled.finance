import{c as E,r as c,cj as L,bn as k,j as t,af as g,aD as O,ai as p,ah as x,aP as N,ac as _,ad as I}from"./vendor-WQejLG7Y.js";import{a as i,n as S}from"./app-q0ws3Yx0.js";import{u as M}from"./fetchList-Dx9pDj27.js";import{a as T,g as B}from"./asset-psWvgQPY.js";import{u as Y,n as R}from"./index-BUY2Cjej.js";import{p as b}from"./pool.service-DXigxJcB.js";import{n as P,o as V}from"./admin.service-hizXY1il.js";import{B as $,d as w}from"./batchStatus-CBLox09F.js";import{a as F,A as h,S as G,b as H}from"./assetStatus-D1v3GkIP.js";import"./index-YDRpzjTi.js";import"./AntdIcon-Bh4kV9XY.js";import"./index-BwXrazuH.js";const{Option:D}=g,K=[{title:"Batch ID",fixed:"left",dataIndex:"id",key:"id",width:"10%"},{title:"Collateral type",width:"10%",render:(r,s)=>{const n=s.pool;return n?t.jsx("div",{style:{margin:0},color:n.assetType===i.LENDING?"green":n.assetType===i.INVOICE?"red":"blue",children:n.assetType===i.LENDING?"Loan":n.assetType===i.INVOICE?"Invoice":n.noteTokenAsset.type===S.SENIOR?"SOT":"JOT"}):null}},{title:"Pool",width:"20%",render:(r,s)=>{var n;return(n=s.pool)==null?void 0:n.name}},{title:"Upload date",render:(r,s)=>s!=null&&s.createdAt?p(s.createdAt).format("DD/MM/YYYY HH:mm"):null},{title:"Originator",render:(r,s)=>x(s,"pool.ownerCompany.companyLegalName","N/A")},{title:"No. of items",key:"numAsset",align:"right",dataIndex:"numAsset"},{title:"Validator",render:(r,s)=>x(s,"pool.validatorCompany.companyLegalName","N/A")||"N/A"},{title:"Status",fixed:"right",render:(r,s)=>t.jsx($,{isOpen:s.isBatchOpen,isApproved:s.numOfApprove>0})}];function z(){const r=E(),[s,n]=c.useState(),[u]=M(b.getPoolList),{isSuperAdmin:a}=Y(l=>l),[e,o]=c.useReducer((l,f)=>({...l,...f}),{batches:[],history:[],isLoading:!1}),m=c.useCallback(async()=>{o({isLoading:!0});const l={poolId:s},f=a?await P(l):await T.getAllBatches(l),C=f.map(d=>d.poolId),A={};let y;try{y=await b.getPools({productIds:L(C)})}catch(d){console.log(d)}y!=null&&y.result&&y.result.forEach(d=>{A[d.id]=d}),o({batches:k(f.map(d=>({...d,pool:A[d.poolId]})),"createdAt","desc"),isLoading:!1})},[s]);return c.useEffect(()=>{m()},[m]),t.jsxs("div",{children:[t.jsx("div",{className:"mt-4",children:t.jsxs(g,{defaultValue:"Pool","data-testid":"collateral-batch-filter-pool",style:{width:180},onChange:l=>{n(l)},children:[t.jsx(D,{value:"",children:"All"}),u==null?void 0:u.map(l=>t.jsx(D,{value:l.id,children:l.name},l.id))]})}),t.jsx("div",{className:"table-responsive mt-6",children:t.jsx(O,{"data-testid":"collateral-batch-table",columns:K,dataSource:e.batches,className:"ant-border-space",loading:e.isLoading,rowKey:l=>l.id,onRow:l=>({onClick:()=>{r(`/pool/${l.poolId}/batch/${l.id}`)}})})})]})}const J=({assets:r,isLoading:s})=>{const n=E();r&&r.sort((a,e)=>e.createdAt-a.createdAt).map(a=>({...a,key:`${a.type}-${a.id}`}));const u=[{dataIndex:"key",title:"ID",key:"key",width:100,render:(a,e)=>{let o="N/A";switch(e.assetType){case i.LENDING:{o=e.debtOrderContract.externalId;break}case i.INVOICE:{o=e.invoice.openItemId;break}}return t.jsx(t.Fragment,{children:t.jsx("div",{children:o})})}},{title:"Type",render:(a,e)=>t.jsx("div",{style:{margin:0},color:e.assetType===i.LENDING?"green":e.assetType===i.INVOICE?"red":"blue",children:e.assetType===i.LENDING?"Loan":e.assetType===i.INVOICE?"Invoice":e.noteTokenAsset.type===S.SENIOR?"SOT":"JOT"})},{dataIndex:"poolId",title:"Pool",key:"id",width:200,render:(a,e)=>e.pool?e.pool.name:t.jsx("span",{style:{color:"#00D395"},children:"Unallocated"})},{title:"Upload date",dataIndex:"createdAt",key:"createdAt",defaultSortOrder:"descend",width:180,render:(a,e)=>(console.log("assetList - row"),console.log(e),a?p(a).format("DD/MM/YYYY HH:mm"):p(e.createdAt).format("DD/MM/YYYY HH:mm")),sorter:(a,e)=>a.createdAt-e.createdAt},{title:"Originator",key:"creatorId",render:(a,e)=>x(e,"ownerCompany.companyLegalName","N/A")},{title:"Batch ID",key:"batchId",dataIndex:"batchId"},{title:"Validator",key:"validator",render:(a,e)=>x(e,"pool.validatorMember.email","N/A")},{dataIndex:"status",title:"Status",width:140,render(a,e){return t.jsx(F,{type:B(e)})}},{title:"Currency balance",dataIndex:"amount",align:"right",key:"amount",render:a=>R(a)},{title:"Origination date",key:"startedAt",render:(a,e)=>{switch(e.assetType){case i.LENDING:return p(e.debtOrderContract.startedAt).format("DD/MM/YYYY");case i.INVOICE:return p(e.invoice.issueDate).format("DD/MM/YYYY");case i.NOTE_TOKEN:return p(e.createdAt).format("DD/MM/YYYY");default:return"N/A"}}},{title:"Due Date",dataIndex:"paymentDueDate",key:"paymentDueDate",render:(a,e)=>{switch(e.assetType){case i.LENDING:return p(x(e,"debtOrderContractInfo.finalMaturityDate")).format("DD/MM/YYYY");case i.INVOICE:return p(e.invoiceDueDate||e.paymentDueDate).format("DD/MM/YYYY");case i.NOTE_TOKEN:return"N/A";default:return[]}}}];return t.jsx(t.Fragment,{children:t.jsx(O,{columns:u,dataSource:r||[],loading:s,scroll:{y:"calc(100vh - 320px)",x:1268},bodyStyle:{cursor:"pointer",overflowX:"auto"},pagination:{showSizeChanger:!1},size:"middle",rowKey:a=>`${a.id}_${a.assetType}`,onRow:a=>({onClick:()=>{switch(a.assetType){case i.NOTE_TOKEN:return n(`/note-token/${a.id}`);case i.LENDING:default:return n(`/lending-place/order-contract/${a.id}`)}}}),children:"Stay calm, data is loading."})})},{Option:j}=g,U=()=>{const{isSuperAdmin:r}=Y(o=>o),[s,n]=c.useReducer((o,m)=>({...o,...m}),{assets:[],history:[],isLoading:!1}),[u,a]=c.useState(""),e=c.useCallback(async()=>{n({isLoading:!0});const o={status:[u]},m=r?await V(o):await T.getAllAssets(o);n({assets:m,isLoading:!1})},[u]);return c.useEffect(()=>{e()},[e]),t.jsxs("div",{children:[t.jsx("div",{className:"my-6",children:t.jsxs(g,{defaultValue:"Status","data-testid":"collateral-batch-filter-status",className:"w-48",onChange:o=>{a(o)},children:[t.jsx(j,{value:"",children:t.jsx(N,{color:"orange",text:"All"})}),[h.TO_BE_APPROVED,h.TO_BE_FINANCED,h.FINANCED,h.PARTIAL_REPAY,h.REPAID,h.REJECT].map(o=>t.jsx(j,{value:o,children:t.jsx(N,{color:H[o],text:G[o]})},o))]})}),t.jsx(J,{"data-testid":"collateral-item-table",isLoading:s.isLoading,assets:[...s.assets],isApproveMode:!0,reloadAssetData:e})]})},v=({isActive:r,children:s,onClick:n})=>t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsx("div",{className:`group inline-flex items-center px-2 py-4 border-b-2 font-semibold text-sm leading-5 cursor-pointer whitespace-nowrap ${r?"border-b-amber-500 text-[#117B37] focus:outline-none focus:text-indigo-800 focus:border-indigo-700":"border-transparent text-gray-500 hover:text-gray-600 hover:border-gray-300 focus:text-gray-600 focus:border-gray-300"}`,onClick:n,children:s}),t.jsx("div",{className:`w-8 bg-green-500 rounded-3xl h-1 ${r?"visible":"invisible"}`})]});function ie(){const[r,s]=c.useState("batch");return t.jsxs(_,{gutter:[24,0],children:[t.jsx(I,{xs:"24",xl:{span:20,offset:2},children:t.jsxs("div",{className:"page-header",children:[t.jsx(w,{style:{fontSize:24},children:"Collateral"}),t.jsxs("nav",{className:"flex border-gray-300 items-center",children:[t.jsx(v,{isActive:r==="batch",onClick:()=>s("batch"),children:"By upload batch"}),t.jsx(v,{isActive:r==="items",onClick:()=>s("items"),children:"By items"})]})]})}),t.jsxs(I,{xs:"24",xl:{span:20,offset:2},children:[r==="batch"&&t.jsx(z,{}),r==="items"&&t.jsx(U,{})]})]})}export{v as TabSelector,ie as default};
