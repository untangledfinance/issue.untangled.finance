import{bq as g,ck as Pe,cC as Te,br as Ce}from"./vendor-WQejLG7Y.js";import{d as Le}from"./index-xQHWsnqV.js";function Ee(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var J={exports:{}},C=typeof Reflect=="object"?Reflect:null,z=C&&typeof C.apply=="function"?C.apply:function(e,s,n){return Function.prototype.apply.call(e,s,n)},k;C&&typeof C.ownKeys=="function"?k=C.ownKeys:Object.getOwnPropertySymbols?k=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:k=function(e){return Object.getOwnPropertyNames(e)};function Oe(t){console&&console.warn&&console.warn(t)}var ie=Number.isNaN||function(e){return e!==e};function l(){l.init.call(this)}J.exports=l;J.exports.once=xe;l.EventEmitter=l;l.prototype._events=void 0;l.prototype._eventsCount=0;l.prototype._maxListeners=void 0;var Z=10;function N(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return Z},set:function(t){if(typeof t!="number"||t<0||ie(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Z=t}});l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};l.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ie(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function oe(t){return t._maxListeners===void 0?l.defaultMaxListeners:t._maxListeners}l.prototype.getMaxListeners=function(){return oe(this)};l.prototype.emit=function(e){for(var s=[],n=1;n<arguments.length;n++)s.push(arguments[n]);var r=e==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var a;if(s.length>0&&(a=s[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var o=i[e];if(o===void 0)return!1;if(typeof o=="function")z(o,this,s);else for(var d=o.length,_=fe(o,d),n=0;n<d;++n)z(_[n],this,s);return!0};function ce(t,e,s,n){var r,i,a;if(N(s),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,s.listener?s.listener:s),i=t._events),a=i[e]),a===void 0)a=i[e]=s,++t._eventsCount;else if(typeof a=="function"?a=i[e]=n?[s,a]:[a,s]:n?a.unshift(s):a.push(s),r=oe(t),r>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,Oe(c)}return t}l.prototype.addListener=function(e,s){return ce(this,e,s,!1)};l.prototype.on=l.prototype.addListener;l.prototype.prependListener=function(e,s){return ce(this,e,s,!0)};function je(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ue(t,e,s){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:s},r=je.bind(n);return r.listener=s,n.wrapFn=r,r}l.prototype.once=function(e,s){return N(s),this.on(e,ue(this,e,s)),this};l.prototype.prependOnceListener=function(e,s){return N(s),this.prependListener(e,ue(this,e,s)),this};l.prototype.removeListener=function(e,s){var n,r,i,a,c;if(N(s),r=this._events,r===void 0)return this;if(n=r[e],n===void 0)return this;if(n===s||n.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||s));else if(typeof n!="function"){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===s||n[a].listener===s){c=n[a].listener,i=a;break}if(i<0)return this;i===0?n.shift():Me(n,i),n.length===1&&(r[e]=n[0]),r.removeListener!==void 0&&this.emit("removeListener",e,c||s)}return this};l.prototype.off=l.prototype.removeListener;l.prototype.removeAllListeners=function(e){var s,n,r;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),a;for(r=0;r<i.length;++r)a=i[r],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=n[e],typeof s=="function")this.removeListener(e,s);else if(s!==void 0)for(r=s.length-1;r>=0;r--)this.removeListener(e,s[r]);return this};function de(t,e,s){var n=t._events;if(n===void 0)return[];var r=n[e];return r===void 0?[]:typeof r=="function"?s?[r.listener||r]:[r]:s?Ie(r):fe(r,r.length)}l.prototype.listeners=function(e){return de(this,e,!0)};l.prototype.rawListeners=function(e){return de(this,e,!1)};l.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):le.call(t,e)};l.prototype.listenerCount=le;function le(t){var e=this._events;if(e!==void 0){var s=e[t];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?k(this._events):[]};function fe(t,e){for(var s=new Array(e),n=0;n<e;++n)s[n]=t[n];return s}function Me(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ie(t){for(var e=new Array(t.length),s=0;s<e.length;++s)e[s]=t[s].listener||t[s];return e}function xe(t,e){return new Promise(function(s,n){function r(a){t.removeListener(e,i),n(a)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",r),s([].slice.call(arguments))}he(t,e,i,{once:!0}),e!=="error"&&Ae(t,r,{once:!0})})}function Ae(t,e,s){typeof t.on=="function"&&he(t,"error",e,s)}function he(t,e,s,n){if(typeof t.on=="function")n.once?t.once(e,s):t.on(e,s);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(i){n.once&&t.removeEventListener(e,r),s(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Re=J.exports,Q={},D={},ge={},H={},_e={},j={},M={};Object.defineProperty(M,"__esModule",{value:!0});M.getSDKVersion=void 0;const Be=()=>"9.1.0";M.getSDKVersion=Be;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.generateRequestId=void 0;const ke=t=>t.toString(16).padStart(2,"0"),He=t=>{const e=new Uint8Array(t/2);return window.crypto.getRandomValues(e),Array.from(e,ke).join("")},Ne=()=>typeof window<"u"?He(10):new Date().getTime().toString(36);q.generateRequestId=Ne;Object.defineProperty(j,"__esModule",{value:!0});j.MessageFormatter=void 0;const De=M,qe=q;class V{}j.MessageFormatter=V;V.makeRequest=(t,e)=>({id:(0,qe.generateRequestId)(),method:t,params:e,env:{sdkVersion:(0,De.getSDKVersion)()}});V.makeResponse=(t,e,s)=>({id:t,success:!0,version:s,data:e});V.makeErrorResponse=(t,e,s)=>({id:t,success:!1,error:e,version:s});var y={};Object.defineProperty(y,"__esModule",{value:!0});y.RestrictedMethods=y.Methods=void 0;var ee;(function(t){t.sendTransactions="sendTransactions",t.rpcCall="rpcCall",t.getChainInfo="getChainInfo",t.getSafeInfo="getSafeInfo",t.getTxBySafeTxHash="getTxBySafeTxHash",t.getSafeBalances="getSafeBalances",t.signMessage="signMessage",t.signTypedMessage="signTypedMessage",t.getEnvironmentInfo="getEnvironmentInfo",t.getOffChainSignature="getOffChainSignature",t.requestAddressBook="requestAddressBook",t.wallet_getPermissions="wallet_getPermissions",t.wallet_requestPermissions="wallet_requestPermissions"})(ee||(y.Methods=ee={}));var te;(function(t){t.requestAddressBook="requestAddressBook"})(te||(y.RestrictedMethods=te={}));(function(t){var e=g&&g.__createBinding||(Object.create?function(i,a,c,o){o===void 0&&(o=c);var d=Object.getOwnPropertyDescriptor(a,c);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[c]}}),Object.defineProperty(i,o,d)}:function(i,a,c,o){o===void 0&&(o=c),i[o]=a[c]}),s=g&&g.__exportStar||function(i,a){for(var c in i)c!=="default"&&!Object.prototype.hasOwnProperty.call(a,c)&&e(a,i,c)};Object.defineProperty(t,"__esModule",{value:!0});const n=j;class r{constructor(a=null,c=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer=typeof window>"u",this.isValidMessage=({origin:o,data:d,source:_})=>{const b=!d,f=!this.isServer&&_===window.parent,u=typeof d.version<"u"&&parseInt(d.version.split(".")[0]),h=typeof u=="number"&&u>=1;let p=!0;return Array.isArray(this.allowedOrigins)&&(p=this.allowedOrigins.find(x=>x.test(o))!==void 0),!b&&f&&h&&p},this.logIncomingMessage=o=>{console.info(`Safe Apps SDK v1: A message was received from origin ${o.origin}. `,o.data)},this.onParentMessage=o=>{this.isValidMessage(o)&&(this.debugMode&&this.logIncomingMessage(o),this.handleIncomingMessage(o.data))},this.handleIncomingMessage=o=>{const{id:d}=o,_=this.callbacks.get(d);_&&(_(o),this.callbacks.delete(d))},this.send=(o,d)=>{const _=n.MessageFormatter.makeRequest(o,d);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(_,"*"),new Promise((b,f)=>{this.callbacks.set(_.id,u=>{if(!u.success){f(new Error(u.error));return}b(u)})})},this.allowedOrigins=a,this.debugMode=c,this.isServer||window.addEventListener("message",this.onParentMessage)}}t.default=r,s(y,t)})(_e);var F={},U={},$={};Object.defineProperty($,"__esModule",{value:!0});$.isObjectEIP712TypedData=void 0;const Ve=t=>typeof t=="object"&&t!=null&&"domain"in t&&"types"in t&&"message"in t;$.isObjectEIP712TypedData=Ve;var pe={};Object.defineProperty(pe,"__esModule",{value:!0});var me={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TransferDirection=t.TransactionStatus=t.TokenType=t.Operation=void 0;var e=Le;Object.defineProperty(t,"Operation",{enumerable:!0,get:function(){return e.Operation}}),Object.defineProperty(t,"TokenType",{enumerable:!0,get:function(){return e.TokenType}}),Object.defineProperty(t,"TransactionStatus",{enumerable:!0,get:function(){return e.TransactionStatus}}),Object.defineProperty(t,"TransferDirection",{enumerable:!0,get:function(){return e.TransferDirection}})})(me);var ve={};Object.defineProperty(ve,"__esModule",{value:!0});(function(t){var e=g&&g.__createBinding||(Object.create?function(n,r,i,a){a===void 0&&(a=i);var c=Object.getOwnPropertyDescriptor(r,i);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[i]}}),Object.defineProperty(n,a,c)}:function(n,r,i,a){a===void 0&&(a=i),n[a]=r[i]}),s=g&&g.__exportStar||function(n,r){for(var i in n)i!=="default"&&!Object.prototype.hasOwnProperty.call(r,i)&&e(r,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),s($,t),s(pe,t),s(me,t),s(ve,t)})(U);Object.defineProperty(F,"__esModule",{value:!0});F.TXs=void 0;const A=y,Fe=U;class Ue{constructor(e){this.communicator=e}async getBySafeTxHash(e){if(!e)throw new Error("Invalid safeTxHash");return(await this.communicator.send(A.Methods.getTxBySafeTxHash,{safeTxHash:e})).data}async signMessage(e){const s={message:e};return(await this.communicator.send(A.Methods.signMessage,s)).data}async signTypedMessage(e){if(!(0,Fe.isObjectEIP712TypedData)(e))throw new Error("Invalid typed data");return(await this.communicator.send(A.Methods.signTypedMessage,{typedData:e})).data}async send({txs:e,params:s}){if(!e||!e.length)throw new Error("No transactions were passed");const n={txs:e,params:s};return(await this.communicator.send(A.Methods.sendTransactions,n)).data}}F.TXs=Ue;var G={},O={};Object.defineProperty(O,"__esModule",{value:!0});O.RPC_CALLS=void 0;O.RPC_CALLS={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"};Object.defineProperty(G,"__esModule",{value:!0});G.Eth=void 0;const m=O,$e=y,w={defaultBlockParam:(t="latest")=>t,returnFullTxObjectParam:(t=!1)=>t,blockNumberToHex:t=>Number.isInteger(t)?`0x${t.toString(16)}`:t};class Ge{constructor(e){this.communicator=e,this.call=this.buildRequest({call:m.RPC_CALLS.eth_call,formatters:[null,w.defaultBlockParam]}),this.getBalance=this.buildRequest({call:m.RPC_CALLS.eth_getBalance,formatters:[null,w.defaultBlockParam]}),this.getCode=this.buildRequest({call:m.RPC_CALLS.eth_getCode,formatters:[null,w.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:m.RPC_CALLS.eth_getStorageAt,formatters:[null,w.blockNumberToHex,w.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:m.RPC_CALLS.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:m.RPC_CALLS.eth_getBlockByHash,formatters:[null,w.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:m.RPC_CALLS.eth_getBlockByNumber,formatters:[w.blockNumberToHex,w.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:m.RPC_CALLS.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:m.RPC_CALLS.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:m.RPC_CALLS.eth_getTransactionCount,formatters:[null,w.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:m.RPC_CALLS.eth_gasPrice}),this.getEstimateGas=s=>this.buildRequest({call:m.RPC_CALLS.eth_estimateGas})([s]),this.setSafeSettings=this.buildRequest({call:m.RPC_CALLS.safe_setSettings})}buildRequest(e){const{call:s,formatters:n}=e;return async r=>{n&&Array.isArray(r)&&n.forEach((c,o)=>{c&&(r[o]=c(r[o]))});const i={call:s,params:r||[]};return(await this.communicator.send($e.Methods.rpcCall,i)).data}}}G.Eth=Ge;var W={};const We=Pe(Te);var L={};Object.defineProperty(L,"__esModule",{value:!0});L.MAGIC_VALUE_BYTES=L.MAGIC_VALUE=void 0;const Ke="0x1626ba7e";L.MAGIC_VALUE=Ke;const Je="0x20c13b0b";L.MAGIC_VALUE_BYTES=Je;var X={},I={},P={};Object.defineProperty(P,"__esModule",{value:!0});P.PermissionsError=P.PERMISSIONS_REQUEST_REJECTED=void 0;P.PERMISSIONS_REQUEST_REJECTED=4001;class Y extends Error{constructor(e,s,n){super(e),this.code=s,this.data=n,Object.setPrototypeOf(this,Y.prototype)}}P.PermissionsError=Y;Object.defineProperty(I,"__esModule",{value:!0});I.Wallet=void 0;const K=y,R=P;class Qe{constructor(e){this.communicator=e}async getPermissions(){return(await this.communicator.send(K.Methods.wallet_getPermissions,void 0)).data}async requestPermissions(e){if(!this.isPermissionRequestValid(e))throw new R.PermissionsError("Permissions request is invalid",R.PERMISSIONS_REQUEST_REJECTED);try{return(await this.communicator.send(K.Methods.wallet_requestPermissions,e)).data}catch{throw new R.PermissionsError("Permissions rejected",R.PERMISSIONS_REQUEST_REJECTED)}}isPermissionRequestValid(e){return e.every(s=>typeof s=="object"?Object.keys(s).every(n=>!!Object.values(K.RestrictedMethods).includes(n)):!1)}}I.Wallet=Qe;Object.defineProperty(X,"__esModule",{value:!0});const Xe=I,se=P,ne=(t,e)=>e.some(s=>s.parentCapability===t),Ye=()=>(t,e,s)=>{const n=s.value;return s.value=async function(){const r=new Xe.Wallet(this.communicator);let i=await r.getPermissions();if(ne(e,i)||(i=await r.requestPermissions([{[e]:{}}])),!ne(e,i))throw new se.PermissionsError("Permissions rejected",se.PERMISSIONS_REQUEST_REJECTED);return n.apply(this)},s};X.default=Ye;var ze=g&&g.__decorate||function(t,e,s,n){var r=arguments.length,i=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,s):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,s,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(r<3?a(i):r>3?a(e,s,i):a(e,s))||i);return r>3&&i&&Object.defineProperty(e,s,i),i},Ze=g&&g.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(W,"__esModule",{value:!0});W.Safe=void 0;const B=We,re=L,S=y,ae=O,et=U,tt=Ze(X);class ye{constructor(e){this.communicator=e}async getChainInfo(){return(await this.communicator.send(S.Methods.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(S.Methods.getSafeInfo,void 0)).data}async experimental_getBalances({currency:e="usd"}={}){return(await this.communicator.send(S.Methods.getSafeBalances,{currency:e})).data}async check1271Signature(e,s="0x"){const n=await this.getInfo(),r=(0,B.encodeFunctionData)({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[e,s]}),i={call:ae.RPC_CALLS.eth_call,params:[{to:n.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(S.Methods.rpcCall,i)).data.slice(0,10).toLowerCase()===re.MAGIC_VALUE}catch{return!1}}async check1271SignatureBytes(e,s="0x"){const n=await this.getInfo(),r=(0,B.encodeFunctionData)({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[e,s]}),i={call:ae.RPC_CALLS.eth_call,params:[{to:n.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(S.Methods.rpcCall,i)).data.slice(0,10).toLowerCase()===re.MAGIC_VALUE_BYTES}catch{return!1}}calculateMessageHash(e){return(0,B.hashMessage)(e)}calculateTypedMessageHash(e){const s=typeof e.domain.chainId=="object"?e.domain.chainId.toNumber():Number(e.domain.chainId);let n=e.primaryType;if(!n){const r=Object.values(e.types),i=Object.keys(e.types).filter(a=>r.every(c=>c.every(({type:o})=>o.replace("[","").replace("]","")!==a)));if(i.length===0||i.length>1)throw new Error("Please specify primaryType");n=i[0]}return(0,B.hashTypedData)({message:e.message,domain:{...e.domain,chainId:s,verifyingContract:e.domain.verifyingContract,salt:e.domain.salt},types:e.types,primaryType:n})}async getOffChainSignature(e){return(await this.communicator.send(S.Methods.getOffChainSignature,e)).data}async isMessageSigned(e,s="0x"){let n;if(typeof e=="string"&&(n=async()=>{const r=this.calculateMessageHash(e);return await this.isMessageHashSigned(r,s)}),(0,et.isObjectEIP712TypedData)(e)&&(n=async()=>{const r=this.calculateTypedMessageHash(e);return await this.isMessageHashSigned(r,s)}),n)return await n();throw new Error("Invalid message type")}async isMessageHashSigned(e,s="0x"){const n=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const r of n)if(await r(e,s))return!0;return!1}async getEnvironmentInfo(){return(await this.communicator.send(S.Methods.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(S.Methods.requestAddressBook,void 0)).data}}W.Safe=ye;ze([(0,tt.default)()],ye.prototype,"requestAddressBook",null);var st=g&&g.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(H,"__esModule",{value:!0});const nt=st(_e),rt=F,at=G,it=W,ot=I;class ct{constructor(e={}){const{allowedDomains:s=null,debug:n=!1}=e;this.communicator=new nt.default(s,n),this.eth=new at.Eth(this.communicator),this.txs=new rt.TXs(this.communicator),this.safe=new it.Safe(this.communicator),this.wallet=new ot.Wallet(this.communicator)}}H.default=ct;(function(t){var e=g&&g.__createBinding||(Object.create?function(a,c,o,d){d===void 0&&(d=o);var _=Object.getOwnPropertyDescriptor(c,o);(!_||("get"in _?!c.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return c[o]}}),Object.defineProperty(a,d,_)}:function(a,c,o,d){d===void 0&&(d=o),a[d]=c[o]}),s=g&&g.__exportStar||function(a,c){for(var o in a)o!=="default"&&!Object.prototype.hasOwnProperty.call(c,o)&&e(c,a,o)},n=g&&g.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSDKVersion=void 0;const r=n(H);t.default=r.default,s(H,t),s(U,t),s(y,t),s(j,t);var i=M;Object.defineProperty(t,"getSDKVersion",{enumerable:!0,get:function(){return i.getSDKVersion}}),s(O,t)})(ge);var E={};Object.defineProperty(E,"__esModule",{value:!0});E.numberToHex=E.getLowerCase=void 0;function ut(t){return t&&t.toLowerCase()}E.getLowerCase=ut;function dt(t){return`0x${t.toString(16)}`}E.numberToHex=dt;Object.defineProperty(D,"__esModule",{value:!0});D.SafeAppProvider=void 0;const T=ge,lt=Re,v=E;class ft extends lt.EventEmitter{constructor(e,s){super(),this.submittedTxs=new Map,this.safe=e,this.sdk=s}async connect(){this.emit("connect",{chainId:this.chainId})}async disconnect(){}get chainId(){return this.safe.chainId}async request(e){var r,i,a,c;const{method:s,params:n=[]}=e;switch(s){case"eth_accounts":return[this.safe.safeAddress];case"net_version":case"eth_chainId":return(0,v.numberToHex)(this.chainId);case"personal_sign":{const[f,u]=n;if(this.safe.safeAddress.toLowerCase()!==u.toLowerCase())throw new Error("The address or message hash is invalid");const h=await this.sdk.txs.signMessage(f);return("signature"in h?h.signature:void 0)||"0x"}case"eth_sign":{const[f,u]=n;if(this.safe.safeAddress.toLowerCase()!==f.toLowerCase()||!u.startsWith("0x"))throw new Error("The address or message hash is invalid");const h=await this.sdk.txs.signMessage(u);return("signature"in h?h.signature:void 0)||"0x"}case"eth_signTypedData":case"eth_signTypedData_v4":{const[f,u]=n,h=typeof u=="string"?JSON.parse(u):u;if(this.safe.safeAddress.toLowerCase()!==f.toLowerCase())throw new Error("The address is invalid");const p=await this.sdk.txs.signTypedMessage(h);return("signature"in p?p.signature:void 0)||"0x"}case"eth_sendTransaction":const o={...n[0],value:n[0].value||"0",data:n[0].data||"0x"};typeof o.gas=="string"&&o.gas.startsWith("0x")&&(o.gas=parseInt(o.gas,16));const d=await this.sdk.txs.send({txs:[o],params:{safeTxGas:o.gas}});return this.submittedTxs.set(d.safeTxHash,{from:this.safe.safeAddress,hash:d.safeTxHash,gas:0,gasPrice:"0x00",nonce:0,input:o.data,value:o.value,to:o.to,blockHash:null,blockNumber:null,transactionIndex:null}),d.safeTxHash;case"eth_blockNumber":return(await this.sdk.eth.getBlockByNumber(["latest"])).number;case"eth_getBalance":return this.sdk.eth.getBalance([(0,v.getLowerCase)(n[0]),n[1]]);case"eth_getCode":return this.sdk.eth.getCode([(0,v.getLowerCase)(n[0]),n[1]]);case"eth_getTransactionCount":return this.sdk.eth.getTransactionCount([(0,v.getLowerCase)(n[0]),n[1]]);case"eth_getStorageAt":return this.sdk.eth.getStorageAt([(0,v.getLowerCase)(n[0]),n[1],n[2]]);case"eth_getBlockByNumber":return this.sdk.eth.getBlockByNumber([n[0],n[1]]);case"eth_getBlockByHash":return this.sdk.eth.getBlockByHash([n[0],n[1]]);case"eth_getTransactionByHash":let b=n[0];try{b=(await this.sdk.txs.getBySafeTxHash(b)).txHash||b}catch{}return this.submittedTxs.has(b)?this.submittedTxs.get(b):this.sdk.eth.getTransactionByHash([b]).then(f=>(f&&(f.hash=n[0]),f));case"eth_getTransactionReceipt":{let f=n[0];try{f=(await this.sdk.txs.getBySafeTxHash(f)).txHash||f}catch{}return this.sdk.eth.getTransactionReceipt([f]).then(u=>(u&&(u.transactionHash=n[0]),u))}case"eth_estimateGas":return this.sdk.eth.getEstimateGas(n[0]);case"eth_call":return this.sdk.eth.call([n[0],n[1]]);case"eth_getLogs":return this.sdk.eth.getPastLogs([n[0]]);case"eth_gasPrice":return this.sdk.eth.getGasPrice();case"wallet_getPermissions":return this.sdk.wallet.getPermissions();case"wallet_requestPermissions":return this.sdk.wallet.requestPermissions(n[0]);case"safe_setSettings":return this.sdk.eth.setSafeSettings([n[0]]);case"wallet_sendCalls":{if(n[0].from!==this.safe.safeAddress)throw Error("Invalid from address");const f=n[0].calls.map((h,p)=>{if(h.chainId!==(0,v.numberToHex)(this.chainId))throw new Error(`Invalid call #${p}: Safe is not on chain ${h.chainId}`);if(!h.to)throw new Error(`Invalid call #${p}: missing "to" field`);return{to:h.to,data:h.data??"0x",value:h.value??(0,v.numberToHex)(0)}}),{safeTxHash:u}=await this.sdk.txs.send({txs:f});return u}case"wallet_getCallsStatus":{const f={[T.TransactionStatus.AWAITING_CONFIRMATIONS]:"PENDING",[T.TransactionStatus.AWAITING_EXECUTION]:"PENDING",[T.TransactionStatus.CANCELLED]:"CONFIRMED",[T.TransactionStatus.FAILED]:"CONFIRMED",[T.TransactionStatus.SUCCESS]:"CONFIRMED"},u=await this.sdk.txs.getBySafeTxHash(n[0]),h=f[u.txStatus];if(!u.txHash)return{status:h};const p=await this.sdk.eth.getTransactionReceipt([u.txHash]);if(!p)return{status:h};const x=((i=(r=u.txData)==null?void 0:r.dataDecoded)==null?void 0:i.method)!=="multiSend"?1:((c=(a=u.txData.dataDecoded.parameters)==null?void 0:a[0].valueDecoded)==null?void 0:c.length)??1,be=Number(p.blockNumber),we=Number(p.gasUsed),Se=Array(x).fill({logs:p.logs,status:(0,v.numberToHex)(u.txStatus===T.TransactionStatus.SUCCESS?1:0),chainId:(0,v.numberToHex)(this.chainId),blockHash:p.blockHash,blockNumber:(0,v.numberToHex)(be),gasUsed:(0,v.numberToHex)(we),transactionHash:u.txHash});return{status:h,receipts:Se}}case"wallet_showCallsStatus":throw new Error(`"${e.method}" not supported`);case"wallet_getCapabilities":return{[(0,v.numberToHex)(this.chainId)]:{atomicBatch:{supported:!0}}};default:throw Error(`"${e.method}" not implemented`)}}send(e,s){e||s("Undefined request"),this.request(e).then(n=>s(null,{jsonrpc:"2.0",id:e.id,result:n})).catch(n=>s(n,null))}}D.SafeAppProvider=ft;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SafeAppProvider=void 0;var e=D;Object.defineProperty(t,"SafeAppProvider",{enumerable:!0,get:function(){return e.SafeAppProvider}})})(Q);const ht=Ce(Q),pt=Ee({__proto__:null,default:ht},[Q]);export{pt as i};
