import{a6 as Ne,d as Ie,r as i,a7 as Z,ah as ee,j as s,ao as Se,ap as pe,aI as x,a9 as R,af as Pe,aJ as $e,aE as re,aK as Ge,B as E,ad as xe,am as Ae,aj as Le,aL as Ke,c as Ue,ai as ye,ak as Oe,al as ke,aM as He,S as Je,a8 as Ye,k as Qe,aN as Xe,ac as Ze,an as es}from"./vendor-WQejLG7Y.js";import{u as fe,g as ss,N as ts,n as ce}from"./index-BUY2Cjej.js";import{u as K}from"./fetchList-Dx9pDj27.js";import{p as U}from"./pool.service-DXigxJcB.js";import{g as as}from"./admin.service-hizXY1il.js";import{u as Fe}from"./useGetLinkedWallet-DOj7aicX.js";import{w as X}from"./web3-KXi-5q2W.js";import{S as $,F as G}from"./SelectFromSource-BeAMiId5.js";import{c as H}from"./company.service-DgXvkGEz.js";import{c as Me}from"./currencies.service-C4ZICYUF.js";import{s as ve}from"./scorecard.service-xSgAmy6z.js";import{u as ls,c as je}from"./util.service-DGlW4vEA.js";import{e as rs,f as Te}from"./index-YDRpzjTi.js";import{S as ns}from"./index-DvfaoUYF.js";import{p as is,a as de,R as os}from"./app-q0ws3Yx0.js";import{u as cs,C as ds}from"./usePoolData-DTvfbm5K.js";import{N as be}from"./NoteTokenBadge-BIE4nR0X.js";import{d as ms}from"./data.service-BjjAEJBf.js";import{m as us}from"./member.service-DLmPl6Jz.js";import"./bank.service-B_Z2xVIm.js";const{Option:hs}=Pe,me={minFirstLossCushion:0,debtCeiling:0},xs={number:{range:"Must be higher than ${min} and less than or equal to ${max}"}},ue={name:"",validatorRequired:!1},ps=({isVisible:r,setVisible:I,reloadPools:v=()=>{}})=>{const{notification:o,message:j}=Ne.useApp(),{address:S,connector:k}=Ie(),{isPoolAdmin:F}=fe(a=>a),L=Fe(),[P,p]=i.useState(!1),[g,b]=i.useState(0),[n,c]=i.useState(ue),[l,M]=i.useState(me),[w,J]=i.useState(void 0),[A,Y]=i.useState([]),[y,B]=i.useState(void 0),[se,O]=i.useState(!1),[V,D]=i.useState([]),[C]=K(H.getAllCompanies),[q]=K(Me.getCurrencies),[t,m]=i.useState({}),[d,T]=i.useState(),[f,N]=i.useState(0),ne=i.useMemo(()=>C!=null&&C.length?C.filter(a=>a.isIssuer):[],[C]),Ee=i.useMemo(()=>C!=null&&C.length?C.filter(a=>a.isValidator):[],[C]),ie=i.useMemo(()=>{const a=[n.name,t==null?void 0:t.companyId,t==null?void 0:t.memberId,l.currencyId,l.minFirstLossCushion>0,l.debtCeiling>0,!n.validatorRequired||n.validatorRequired&&!!w&&!!y].every(Boolean),u=[V.length].every(Boolean);return[a,u]},[l.currencyId,l.debtCeiling,l.minFirstLossCushion,t==null?void 0:t.companyId,t==null?void 0:t.memberId,n.name,n.validatorRequired,V.length,w,y]),Re=async a=>{const u=await H.getUsersByCompanyId(a);m({companyId:a,members:u})},[js]=Z.useForm(),Be=a=>{var W,ae;const z=t.members.find(_=>_.id==a),h=(ae=(W=z.member_wallet)==null?void 0:W[0])==null?void 0:ae.walletAddress;if(!h)return o.error({message:`Member: ${z.email} doesn't have a linked wallet`});m(_=>({..._,walletAddress:h,memberId:a,member:z}))},Ve=async a=>{c(u=>({...u,validatorRequired:a})),a||(J(void 0),B(void 0),Y([]))},De=async a=>{let u;a?u=await H.getUsersByCompanyId(a):u=[],J(a),Y(u),B(void 0)},qe=async a=>{B(a)},te=i.useMemo(()=>{if(!n.validatorRequired||!y)return null;const a=A.find(u=>u.id==y);return ee(a,"member_wallet.[0].walletAddress")},[n.validatorRequired,A,y]),Q=q&&q.find(a=>a.id==l.currencyId),[ge,ze]=i.useState(void 0),We=async()=>{var u,z;const a=await rs();if(p(!0),f===0)try{if(String(S).toLowerCase()!==String(L).toLowerCase())return o.error({message:`Current wallet address is not valid.
            Please connect to wallet
            ${L}`});if(!F)return o.error({message:"Current wallet address does not have permission to create pool"});if(!l.minFirstLossCushion||l.minFirstLossCushion<=0||l.minFirstLossCushion>100)return o.error({message:"Please ensure that the specified amount is greater than 0 and equal to or less than 100."});console.log("----> grant validator permission for:",te);const h=Le(l.debtCeiling*10**Q.decimals).toLocaleString("fullwide",{useGrouping:!1}),W=X.eth.abi.encodeParameters([{type:"tuple",components:[{name:"currency",type:"address"},{name:"minFirstLossCushion",type:"uint32"},{name:"validatorRequired",type:"bool"},{name:"debtCeiling",type:"uint256"}]}],[{currency:String(Q.tokenAddress),minFirstLossCushion:String(l.minFirstLossCushion*1e4),validatorRequired:!!n.validatorRequired,debtCeiling:h}]);console.log("--->call newPoolInstance:",[Ke(Date.now()),t.walletAddress,W]);const ae=await a.send("newPoolInstance",[X.utils.padLeft(X.utils.toHex(Date.now()),64),t.walletAddress,W]),_=await ls.waitForTransactionReceipt(ae,k);T(_);const oe=await je(U.getPoolByTx,[_.transactionHash],3e3);ze((u=oe==null?void 0:oe.result)==null?void 0:u.id),n.validatorRequired?N(33):N(50)}catch(h){return console.error(h),o.error({message:(h==null?void 0:h.message)||"Something went wrong"})}finally{p(!1)}if(f===33||f===50)try{const h=(z=d==null?void 0:d.logs[0])==null?void 0:z.address;await ve.setScorecardsToContract(h,V,S),await je(U.getPoolScoreCard,[ge],3e3),await U.createNewPool(ge,Object.assign({name:n.name},n.validatorRequired?{validatorMemberId:y,validatorCompanyId:w}:{})),n.validatorRequired?N(66):(N(100),j.success("Create new pool successfully"),await v(),I(!1),N(0))}catch(h){return console.error(h),o.error({message:(h==null?void 0:h.message)||"Something went wrong"})}finally{p(!1)}if(f===66)try{const h=d.events.NewPoolCreated.returnValues.instanceAddress;await(await Te(h)).methods.grantRole(X.utils.keccak256("VALIDATOR_ROLE"),te).send({from:S,maxPriorityFeePerGas:null,maxFeePerGas:null}),N(100),j.success("Create new pool successfully"),await v(),I(!1),N(0)}catch{return console.error(e),o.error({message:(e==null?void 0:e.message)||"Something went wrong"})}finally{p(!1)}};i.useEffect(()=>{(async()=>{O(!0);try{const u=await ve.getActiveScorecards();D(u)}catch(u){console.error(u)}O(!1)})()},[]),i.useEffect(()=>{r&&b(0),c(ue),M(me)},[r]);const _e={header:{backgroundColor:"transparent"},content:{borderRadius:24,backgroundColor:"#F0F0F0"}};return s.jsx(Se,{onCancel:()=>{I(!1),c(ue),M(me)},footer:null,styles:_e,width:"65vw",open:r,title:s.jsx("span",{className:"text-lg",children:"Create new pool"}),style:{minWidth:640,paddingBottom:0},children:s.jsxs("div",{className:"w-full flex flex-col items-center",children:[s.jsx("div",{className:"lg:w-1/2 md:w-2/3 w-10/12",children:s.jsx(pe,{onChange:a=>{a===0&&b(a),ie[g]&&b(a)},labelPlacement:"vertical",initial:0,type:"default",style:{whiteSpace:"nowrap"},direction:"horizontal",items:[{title:"Pool parameters",style:{fontWeight:600}},{title:"Risk score card",style:{fontWeight:600}}],current:g})}),g===0&&s.jsxs("div",{className:"w-full flex flex-col items-center",children:[s.jsx("div",{className:"lg:w-1/2 md:w-2/3 w-10/12",children:s.jsxs(Z,{layout:"vertical",validateMessages:xs,className:"mt-5",children:[s.jsx(x,{label:"Pool name",className:"mb-4",children:s.jsx(R,{placeholder:"Enter pool name",id:"name",value:n.name,onChange:a=>c({...n,name:a.target.value})})}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"16px"},children:[s.jsx(x,{label:"Issuer company",className:"flex-1 mb-4",children:s.jsx($,{style:{flex:1},placeholder:"Issuer company",items:ne,nameKey:"companyLegalName",selectedValue:t.companyId,onSelect:async a=>{Re(a)}})}),s.jsx(x,{label:"Issuer email",className:"flex-1 mb-4",children:s.jsx($,{isMember:!0,type:"select",allowNewValue:!0,items:t.members||[],nameKey:"email",placeholder:"Issuer email",selectedValue:t.memberId,onSelect:a=>Be(a)})})]}),s.jsx(x,{label:"Currency",className:"mb-4",children:s.jsx(G,{type:"select",style:{width:"100%"},value:l.currencyId,showSearch:!0,id:"currency",placeholder:"Currency",onChange:a=>M({...l,currencyId:a}),children:q&&q.map(a=>s.jsx(hs,{value:a.id,children:a.shortCode},a.shortCode))})}),s.jsx("div",{children:s.jsx(Z.Item,{label:"Min first loss buffer",tooltip:{title:"Minimum rate of JOT amount over total pool reserve. Pool Admin can update it later.",icon:s.jsx(re,{}),color:"#B3B7B5",overlayInnerStyle:{width:370}},name:"minFirstLossCushion",rules:[{type:"number",min:0,max:100}],className:"mb-4",children:s.jsx($e,{type:"input-number-v2",style:{width:"100%"},value:l.minFirstLossCushion||0,id:"minFirstLossCushion",suffix:"%",onChange:a=>M({...l,minFirstLossCushion:a})})})}),s.jsx("div",{children:s.jsx(x,{label:"Debt Ceiling",tooltip:{title:"Maximum pool investment amount. Pool Admin can update it later",icon:s.jsx(re,{}),color:"#B3B7B5",overlayInnerStyle:{width:370}},className:"mb-4",children:s.jsx(G,{type:"input-number-v2",style:{width:"100%"},value:l.debtCeiling||0,id:"debtCeiling",suffix:(Q==null?void 0:Q.tokenSymbol)||s.jsx("span",{}),onChange:a=>M({...l,debtCeiling:a})})})}),s.jsx(x,{label:"Approval option",className:"mb-4",children:s.jsx(Ge,{checked:n.validatorRequired,onChange:a=>Ve(a.target.checked),children:"Require validators"})}),n.validatorRequired&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"16px"},children:[s.jsx(x,{label:"Name",className:"flex-1 mb-4",children:s.jsx($,{placeholder:"Validator Company",items:Ee,nameKey:"companyLegalName",selectedValue:w,onSelect:De})}),s.jsx(x,{label:"Validator Email",className:"flex-1 mb-4",children:s.jsx($,{isMember:!0,type:"select",allowNewValue:!0,items:A,nameKey:"email",placeholder:"Validator Email",selectedValue:y,onSelect:qe})})]}),!!te&&s.jsxs("p",{children:["*Validator Wallet Address: ",te]})]})]})}),s.jsx("div",{className:"w-full flex justify-end",children:s.jsx(E,{className:"px-4 shadow-none",loading:P,disabled:!ie[0],onClick:()=>{if(!l.minFirstLossCushion||l.minFirstLossCushion<=0||l.minFirstLossCushion>100)return o.error({message:"Please ensure that the specified amount is greater than 0 and equal to or less than 100."});b(g+1)},type:"primary",style:{width:"120px",height:"40px"},children:"Next"})})]}),g===1&&s.jsxs(xe,{className:"w-full",children:[s.jsx(ns,{editable:!0,scorecards:V,isLoading:se,setScorecards:D}),s.jsx("div",{style:{margin:24},children:s.jsx(Ae,{percent:f})}),s.jsxs("div",{className:"w-full flex justify-end gap-4",children:[f<33&&s.jsx(E,{onClick:()=>b(a=>a-1),type:"disable",className:"shadow-none w-40 bg-[#25272614] hover:bg-[#25272614] h-12",shape:"round",children:"Previous"}),s.jsxs(E,{className:"shadow-none w-40 h-12",shape:"round",disabled:!ie[1],loading:P,onClick:We,type:"primary",children:[f===0&&"Create Pool",[33,50].includes(f)&&"Update riskscore",f===66&&"Grant validator"]})]})]})]})})};function fs({pool:r}){console.log(r);const I=Ue(),v=ss(ee(r,"currency.shortCode","")),o=r.poolEvents?r.poolEvents[0]:null,{targetAmount:j,poolValue:S,remainingAmount:k,projectedAPY:F,loadingPoolData:L}=cs({pool:r,event:o});let P=!1;o&&(o.status===is.eventStatuses.FINISHED||ye(o.endTime).diff(ye(new Date),"minutes")<=0)&&(P=!0);const p=ts[r==null?void 0:r.chainId],g=i.useMemo(()=>{var c,l;return!!((l=(c=r==null?void 0:r.poolEvents)==null?void 0:c[0])!=null&&l.notesTokenAddress)},[r]),b=i.useMemo(()=>{var c,l;return!!((l=(c=r==null?void 0:r.poolEvents)==null?void 0:c[0])!=null&&l.juniorNotesTokenAddress)},[r]),n=i.useMemo(()=>Le((j-k)/j*100,2),[j,k]);return s.jsxs(Oe,{className:"bg-pool-card-bg rounded-3xl w-full cursor-pointer",onClick:()=>{I(`/pool-setting/${r.id}/notes`)},loading:L,children:[s.jsxs("div",{children:[s.jsxs("div",{className:"min-h-[50px]",children:[s.jsx("span",{className:"text-gray-900 font-semibold mr-2 text-lg ",children:r.name}),b?s.jsx(be,{noteType:"Junior"}):void 0,s.jsx("span",{className:"inline-block w-2"}),g?s.jsx(be,{noteType:"Senior"}):void 0,p&&s.jsx("div",{className:"bg-[#25272614] inline absolute top-7 right-6 rounded-2xl text-gray-900 px-2 ",children:p.name})]}),s.jsxs("div",{className:"min-h-[100px]",children:[s.jsx("div",{className:"overflow-ellipsis text-pool-card-info",children:r.shortDescription}),!!o&&s.jsx(ds,{endTime:o.closedAt||o.endTime,isClosed:P,event:o})]})]}),s.jsxs("div",{className:"flex flex-row",children:[s.jsxs("div",{className:"grow-[2]",children:[s.jsx("div",{className:"text-pool-card-info",children:"Projected APY (%)"}),s.jsx("div",{children:g?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"font-bold text-3xl",children:ce(F)}),s.jsx("span",{className:"text-2xl text-pool-card-info ml-1",children:"%"})]}):s.jsx("span",{className:"font-bold text-3xl",children:"Variable"})}),s.jsx("div",{className:"w-4/5",children:s.jsx(ke,{className:"mt-1 mb-0",orientationMargin:1})}),s.jsxs("div",{children:[s.jsxs("p",{className:"mt-3 mb-0 text-xs text-pool-card-info ",children:["Pool value (",v,")"]}),s.jsx("p",{className:" font-semibold mt-1 mb-0 text-base",children:ce(S)})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"mt-3 mb-0 text-xs text-pool-card-info ",children:["Investment capacity (",v,")"]}),s.jsx("p",{className:"mt-1 mb-0  font-semibold text-base",children:ce(k)})]})]}),s.jsx("div",{className:"grow-0 flex flex-col justify-end",children:s.jsx(Ae,{size:100,strokeLinecap:"butt",strokeWidth:"10",strokeColor:"#1AB752",format:c=>`${c}%`,type:"circle",percent:n})})]})]})}function gs({pool:r,triggerInitPoolModal:I}){const{userId:v}=fe(j=>j),o=i.useMemo(()=>(r==null?void 0:r.issuerMemberId)===v,[r==null?void 0:r.issuerMemberId,v]);return s.jsx(Oe,{className:"bg-pool-card-bg rounded-3xl w-full cursor-pointer h-full",styles:{body:{height:"100%"}},children:s.jsxs("div",{className:"flex flex-col h-full justify-between h-full",children:[s.jsxs("div",{className:"flex-none",children:[s.jsx("div",{children:s.jsx("span",{className:"text-gray-900 font-semibold mr-2 text-lg shrink-0",children:r.name})}),s.jsx("div",{className:"min-h-[50px]",children:s.jsx("p",{className:"overflow-ellipsis",children:r.shortDescription})})]}),s.jsxs("div",{className:"flex flex-col w-full grow justify-end",children:[s.jsxs("div",{className:"bg-[#25272614] rounded-2xl p-4 flex flex-row items-center",children:[s.jsx("span",{className:"rounded-full bg-white w-14 h-14 inline-block mr-3 shrink-0"}),s.jsx("span",{className:"text-pool-card-info j",children:"This pool is under construction!"})]}),o&&s.jsx(E,{style:{marginTop:24,borderRadius:32},onClick:I,type:"primary",children:"Initialize pool"})]})]})},r.id)}const{Option:le}=Pe,{Step:we}=pe,he={name:void 0,issuerCompanyId:void 0,issuerMemberId:void 0,shortDescription:"",paragraphSummary:""},Ce={minFirstLossCushion:0,debtCeiling:0,assetType:void 0,countryId:void 0,currencyId:void 0},ys=({isVisible:r,setVisible:I,reloadPools:v=()=>{},currentPool:o,setCurrentPool:j})=>{const{notification:S,message:k}=Ne.useApp(),{address:F}=Ie(),[L,P]=i.useState(!1),[p,g]=i.useState(0),b=Fe(),[n,c]=i.useState(he),[l,M]=i.useState(Ce),[w,J]=i.useState([{}]),[A,Y]=i.useState(null),[y]=K(H.getAllCompanies),[B]=K(Me.getCurrencies),[se]=K(ms.getCountries),O=B&&B.find(t=>t.id==l.currencyId),V=i.useMemo(()=>y!=null&&y.length?y.filter(t=>t.isOriginator):[],[y]),D=i.useMemo(()=>{const t=Object.values(n).every(Boolean),m=[l.assetType,l.countryId,w.every(d=>!!d.memberId&&!!d.companyId)].every(Boolean);return[t,m]},[l.assetType,l.countryId,w,n]),C=async(t,m,d)=>{let T=[];m==="companyId"&&(T=await H.getUsersByCompanyId(d));const f=Qe(w,N=>{N[t][m]=d,m==="companyId"&&(N[t].members=T,delete N[t].memberId),m==="memberId"&&(N[t].memberWallet=ee(N[t].members.find(ne=>ne.id==d),"member_wallet[0].walletAddress"))});J(f)},q=async()=>{P(!0);try{if(String(b).toLowerCase()!==String(F).toLowerCase())return S.error({message:`Please connect to address: ${b}`});const t=await Te(o.poolContractAddress),m=await Promise.all(w.map(d=>us.getWallet(d.memberId,d.companyId)));for(let d=0;d<w.length;d++){const T=w[d];if(!m[d].walletAddress){const f=Xe(T.members).email;return S.error({message:`Originator ${f} has not linked wallet`})}}console.log("---> originatorWallets: ",m);for(const d of m)await t.methods.grantRole(X.utils.keccak256("ORIGINATOR_ROLE"),d.walletAddress).send({from:F,maxPriorityFeePerGas:null,maxFeePerGas:null});await U.initializePool(o.id,{id:o.id,shortDescription:n.shortDescription,paragraphSummary:n.paragraphSummary,poolProfilePhoto:"",assetType:l.assetType,countryId:l.countryId,originators:w.map(d=>({memberId:d.memberId,companyId:d.companyId})),originatorWallets:m}),await U.createUpdateFilterTemplate({name:`${o.name} - filter`,isMain:!0,poolId:o.id,assetType:l.assetType}),k.success("Initialize pool successfully"),v(),I(!1)}catch(t){return console.error(t),S.error({message:(t==null?void 0:t.message)||"Something went wrong"})}finally{P(!1)}};return i.useEffect(()=>{o&&(c({...he,name:o.name,issuerCompanyId:o.ownerCompanyId,issuerMemberId:o.ownerMemberId}),M({...Ce,currencyId:o.currencyId,minFirstLossCushion:o.minFirstLossCushion,debtCeiling:o.debtCeiling||"not found"}))},[o]),i.useEffect(()=>{(async()=>{if(!n.issuerCompanyId||!n.issuerCompanyId)return;const m=y.find(f=>f.id===n.issuerCompanyId);if(!m)return;const T=(await H.getUsersByCompanyId(n.issuerCompanyId)).find(f=>f.id===n.issuerMemberId);T&&Y({company:m.companyLegalName,email:T.email})})()},[o,y,n.issuerCompanyId,n.issuerMemberId]),i.useEffect(()=>{r&&(g(0),J([{}]))},[r]),s.jsx(Se,{onCancel:()=>{I(!1),j(),c(he),Y({company:"",email:""})},footer:null,open:r,width:"640px",title:s.jsx("span",{className:"text-lg",children:"Initialize pool"}),className:"w-full bottom-0",centered:!0,children:s.jsxs("div",{className:"w-full flex flex-col items-center",children:[s.jsx("div",{className:"lg:w-1/2 md:w-2/3 w-10/12",children:s.jsxs(pe,{onChange:t=>{t===0&&g(t),D[p]&&g(t)},labelPlacement:"vertical",initial:0,type:"default",className:"whitespace-nowrap",direction:"horizontal",current:p,children:[s.jsx(we,{title:"Overview"}),s.jsx(we,{title:"Collateral"})]})}),s.jsxs("div",{className:"w-full",children:[p===0&&s.jsxs("div",{children:[s.jsxs(Z,{layout:"vertical",className:"mt-5",children:[s.jsx(x,{label:"Pool name",children:s.jsx(R,{placeholder:"Enter pool name",disabled:!0,value:n.name,readOnly:!0})}),s.jsxs("div",{className:"flex justify-between relative gap-4",children:[s.jsx(x,{label:"Issuer company",className:"flex-1",children:s.jsx(R,{disabled:!0,value:(A==null?void 0:A.company)||"",readOnly:!0})}),s.jsx(x,{label:"Issuer email",className:"flex-1",children:s.jsx(R,{disabled:!0,value:(A==null?void 0:A.email)||"",readOnly:!0})})]}),s.jsxs(x,{label:"Pool in words",children:[s.jsx(R.TextArea,{maxLength:35,className:"!h-32",placeholder:"Enter text ...",type:"textarea",value:n.shortDescription,onChange:t=>{t.target.value.length<=35&&c({...n,shortDescription:t.target.value})}}),s.jsxs("div",{className:"text-right text-gray-400 mt-2",children:[ee(n,"shortDescription.length",0),"/35"]})]}),s.jsxs(x,{label:"Paragraph summary",children:[s.jsx(R.TextArea,{maxLength:350,className:"!h-32",placeholder:"Enter text ...",type:"textarea",value:n.paragraphSummary,onChange:t=>{t.target.value.length<=350&&c({...n,paragraphSummary:t.target.value})}}),s.jsxs("div",{className:"text-right text-gray-400 mt-2",children:[ee(n,"paragraphSummary.length",0),"/350"]})]})]}),s.jsx("div",{className:"text-right",children:s.jsx(E,{loading:L,disabled:!D[0]||!A,onClick:()=>{g(p+1)},type:"primary",children:"Next"})})]}),p===1&&s.jsxs("div",{className:"w-full",children:[s.jsxs(Z,{layout:"vertical",className:"mt-5",children:[s.jsx(x,{label:"Collateral type",children:s.jsxs(G,{type:"select",value:l.assetType,className:"w-full",placeholder:"Collateral type",onChange:t=>M({...l,assetType:t}),children:[s.jsx(le,{value:de.INVOICE,children:"Invoices"}),s.jsx(le,{value:de.LENDING,children:"SME Loans"}),s.jsx(le,{value:de.NOTE_TOKEN,children:"Note Tokens"})]})}),s.jsx(x,{label:"Country",children:s.jsx(G,{type:"select",className:"w-full",value:l.countryId,showSearch:!0,id:"country",placeholder:"Country",onChange:t=>M({...l,countryId:t}),children:se&&se.map(t=>s.jsx(le,{value:t.id,children:t.name},t.id))})}),s.jsx(x,{label:"Currency",children:s.jsx(R,{className:"w-full",placeholder:"Currency",id:"currency",disabled:!0,value:(O==null?void 0:O.tokenSymbol)||"not found",readOnly:!0})}),s.jsx(x,{label:"Originators",children:s.jsx("div",{className:"gap-3",children:w.map((t,m)=>s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex flex-1 justify-between relative gap-4",children:[s.jsx($,{className:"w-full",placeholder:"Originator Company",items:V,nameKey:"companyLegalName",selectedValue:t.companyId,onSelect:async d=>{C(m,"companyId",d)}}),s.jsx($,{isMember:!0,type:"select",className:"w-full",items:t.members||[],nameKey:"email",placeholder:"Originator Email",selectedValue:t.memberId,onSelect:d=>C(m,"memberId",d)})]}),!!t.companyId&&!!t.memberId&&s.jsxs(He,{className:"mt-1 px-2",children:["*Wallet address:"," ",!!(t!=null&&t.memberWallet)&&(t==null?void 0:t.memberWallet)||"The account has not been linked to a wallet"]})]},m))})}),s.jsx(x,{label:"Min first loss buffer",tooltip:{title:"Min first loss buffer (must be greater than 0)",icon:s.jsx(re,{}),color:"white"},children:s.jsx(G,{addonAfter:"%",type:"input-number",className:"w-full",value:l.minFirstLossCushion/os,id:"minFirstLossCushion",disabled:!0,readOnly:!0})}),s.jsx(x,{label:"Debt ceiling",tooltip:{title:"Debt ceiling - must be greater than 0",icon:s.jsx(re,{}),color:"white"},children:s.jsx(G,{type:"input-number",className:"w-full",value:new Je(l.debtCeiling).div(10**O.decimals),id:"debtCeiling",addonAfter:(O==null?void 0:O.tokenSymbol)||s.jsx("span",{}),disabled:!0,readOnly:!0})})]}),s.jsxs("div",{className:"gap-2 mt-2",children:[p===1&&s.jsx(Ye,{message:`Collateral settings cannot be edited once the pool is
                  initialized. Please review it carefully!`,type:"warning",showIcon:!0}),s.jsxs("div",{className:"flex justify-end w-full mt-3 relative gap-3",children:[s.jsx(E,{onClick:()=>g(t=>t-1),children:"Back"}),s.jsx(E,{disabled:!D[1],loading:L,onClick:q,type:"primary",children:"Initialize Pool"})]})]})]})]})]})})},vs=6,zs=()=>{const{isPoolAdmin:r,isSuperAdmin:I}=fe(c=>c),[v,o,j]=K(I?as:U.getPoolList),[S,k]=i.useState(6),[F,L]=i.useState(!1),[P,p]=i.useState(!1),[g,b]=i.useState(),n=c=>{b(c),p(!0)};return s.jsxs("div",{className:"xl:mx-10 lg:mt-6 md:mx-3 sm:mx-1",children:[r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-4xl font-bold",children:"Issue"}),s.jsx(E,{type:"primary",onClick:()=>L(!0),disabled:!r,children:"Create New Pool"})]}),s.jsx(ke,{})]}),s.jsxs(Ze,{gutter:[20,20],children:[o?s.jsx(es,{active:!0}):v.length===0?s.jsx("div",{children:"No Active Pools"}):s.jsx(s.Fragment,{children:v.slice(0,S).map(c=>c.originatorCompanyId?s.jsx(xe,{xl:8,lg:12,md:12,sm:24,className:"flex",children:s.jsx(fs,{pool:c},c.id)},c.id):s.jsx(xe,{xl:8,lg:12,md:12,sm:24,className:"flex",children:s.jsx(gs,{pool:c,triggerInitPoolModal:()=>n(c)},c.id)},c.id))}),S<v.length&&s.jsx("div",{className:"flex w-full justify-center",children:s.jsx(E,{onClick:()=>k(c=>c+vs),children:"View more"})})]}),F&&s.jsx(ps,{reloadPools:j,isVisible:F,setVisible:L}),P&&s.jsx(ys,{currentPool:g,setCurrentPool:b,reloadPools:j,isVisible:P,setVisible:p})]})};export{zs as default};
