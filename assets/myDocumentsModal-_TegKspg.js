import{a6 as z,r as n,j as e,ao as q,a9 as Q,aK as U,B as r,P as t,ah as I,ac as W,ad as X,an as Z}from"./vendor-WQejLG7Y.js";import{S as ee,l as m,E as se,a as te,P as ne,D as ae,e as ie}from"./pdf-DFr8ztBQ.js";import{e as _}from"./app-q0ws3Yx0.js";import{u as V}from"./index-BUY2Cjej.js";import{a as oe}from"./attachment.service-CbFqwko5.js";const F=({visible:y,onClose:d,documentId:g,reloadDocument:b,onSignCallback:x})=>{const{message:p}=z.useApp(),[a,w]=n.useState(null),[h,D]=n.useState(""),[v,f]=n.useState(!1),[o,i]=n.useState({signAsPersonal:!1,signAsBusiness:!1}),{user:l}=V(s=>s);n.useEffect(()=>{setTimeout(()=>{if(document.getElementById("signature-pad")&&!a){const s=new ee(document.getElementById("signature-pad"),{backgroundColor:"rgba(255, 255, 255, 0)",penColor:"rgb(0, 0, 0)"});w(s)}},500)},[y]);const c=n.useCallback(async()=>{if(a&&!a.isEmpty()){const s=a.toDataURL("image/png"),C=s.length-22,k=4*Math.ceil(C/3)*.5624896334383812+1,{sasUrl:S,uniqueKey:A}=await m.getUploadSignatureUrl(g,{file_name:"signature",file_size:k,file_type:"image/png"});return await oe.uploadSignature(S,s),A}},[a,g]),u=()=>{a&&a.clear(),D(""),i({signAsPersonal:!1,signAsBusiness:!1}),d()};return e.jsxs(q,{style:{zIndex:1e3},open:y,onCancel:u,footer:null,children:[e.jsx("b",{style:{fontSize:20},children:"Sign document"}),e.jsx("center",{children:e.jsx("div",{style:{marginTop:20,width:300,height:200,border:"1px solid #e8e8e8",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.27), 0 0 40px rgba(0, 0, 0, 0.08) inset"},children:e.jsx("canvas",{id:"signature-pad",className:"signature-pad",width:"300",height:"200"})})}),e.jsx("center",{children:e.jsx(Q,{value:h,onChange:s=>D(s.target.value),placeholder:"Name",style:{marginTop:10,width:300}})}),e.jsx("div",{style:{marginTop:10},children:"I agree my signature above to be a valid means of signing."}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(U,{checked:o.signAsBusiness,onChange:s=>i({...o,signAsBusiness:s.target.checked}),children:["Sign on behalf of ",l==null?void 0:l.companyName]})}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(U,{checked:o.signAsPersonal,onChange:s=>i({...o,signAsPersonal:s.target.checked}),children:["Sign as ",l==null?void 0:l.name]})}),e.jsxs("div",{style:{marginTop:10,textAlign:"right"},children:[e.jsx(r,{onClick:()=>a&&a.clear(),children:"Clear signature"}),e.jsx(r,{style:{margin:"0 10px"},onClick:u,children:"Cancel"}),e.jsx(r,{loading:v,onClick:async()=>{f(!0);try{const s=await c();await m.insertSignatureIntoDocument(g,{signerName:h,signatureFile:{uniqueKey:s}}),f(!1),u(),p.success("Signed successfull"),b(g),setTimeout(()=>{x&&x()},2e3)}catch(s){p.error(s.message||"Signing failed")}f(!1)},disabled:!h||!o.signAsBusiness||!o.signAsPersonal,type:"primary",children:"Sign"})]})]})};F.propTypes={visible:t.bool,onClose:t.func,reloadDocument:t.func,onSignCallback:t.func};const le=({visible:y,onClose:d,disableEdit:g,reloadGeneratedList:b,isSign:x,onCreateNewDocument:p,disableCreateNew:a=!1,preSelectedDocumentId:w,shouldSign:h,defaultHtmlParse:D})=>{const{message:v}=z.useApp(),{userId:f,companyId:o}=V(j=>j),[i,l]=n.useState(w),[c,u]=n.useState(null),[s,C]=n.useState({}),[k,S]=n.useState(!1),[A,P]=n.useState(!1),[T,B]=n.useState(!1),[G,N]=n.useState(!1),H=n.useRef(),L=async j=>{try{B(!0);const[R,{sasUrl:$}]=await Promise.all([m.getDocumentById(j),m.getDocumentAttachment(j)]),J=await m.getDocumentContentViaURL($);u(J),console.log("getDocumentDetail - documentDetail: ",R),C(R)}finally{B(!1)}};n.useEffect(()=>{i&&L(i)},[i]);const E=()=>{l(null),u(null)},K=I(s,"creatorId")===f&&I(s,"creatorCompanyId")===o,M=s.status===_.status.SIGNED,O=I(s,"category")===_.category.LEGAL,Y=async()=>{c&&(N(!0),ie(c,`${s.name}.pdf`),N(!1))};return e.jsxs(q,{onCancel:()=>{d(),E()},footer:null,width:"100vw",open:y,style:{top:0,padding:0},children:[e.jsx(W,{children:e.jsx(X,{xs:{span:18,offset:3},children:e.jsxs("div",{style:{height:"calc(100vh - 70px)",width:"100%",marginTop:20},children:[!a&&!i&&p&&e.jsx(r,{onClick:()=>{p(),d()},style:{marginBottom:20,marginLeft:20},type:"primary",size:"large",children:"+ New Document"}),T&&e.jsx(Z,{active:!0,loading:!0}),!T&&i&&c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20},children:[h&&!x&&O&&e.jsx(r,{onClick:()=>P(!0),className:"mr-2",type:"primary",children:"Sign"}),c&&e.jsx(r,{style:{marginRight:10},onClick:Y,loading:G,children:"Download"}),K&&e.jsxs(e.Fragment,{children:[!g&&!M&&e.jsx(r,{onClick:()=>{se.dispatch(te.EDIT_MY_DOCUMENT,{documentId:i,templateId:s.templateId,questions:s.legal_template.legal_questions}),d(),E()},style:{marginRight:10},type:"primary",children:"Edit"}),!M&&e.jsx(r,{loading:k,onClick:async()=>{S(!0),await m.deleteDocument(i),S(!1),d(),E(),v.success("Delete document successfully")},type:"danger",children:"Delete"})]})]}),e.jsx("div",{ref:H,children:D?e.jsx("div",{className:"w-full bg-white overflow-y-auto",style:{maxHeight:"calc(100vh - 120px)"},id:"doc-content",children:ne(c)}):e.jsx(ae,{doc:c})})]})]})})}),e.jsx(F,{reloadDocument:L,documentId:s.id,visible:A,onClose:()=>{P(!1),d(),b()}})]})};le.propTypes={visible:t.bool,onClose:t.func,reloadGeneratedList:t.func,poolId:t.number,isSign:t.bool,disableEdit:t.bool,onCreateNewDocument:t.func,disableCreateNew:t.bool,preSelectedDocumentId:t.number,viewOnly:t.bool,defaultHtmlParse:t.bool};export{le as M};
