import{r as d,a6 as N,d as C,j as e,B as O,S as T,ao as _,ac as g,ad as p,a7 as j,ak as P,ai as $,ar as W,D as V,au as Y,av as L}from"./vendor-WQejLG7Y.js";import{p as R}from"./pool.service-DXigxJcB.js";import{k as F,d as q}from"./index-YDRpzjTi.js";import{i as J,a as H}from"./AntdIcon-Bh4kV9XY.js";import{o as U,B as G}from"./index-BwXrazuH.js";import{d as K}from"./index-BUY2Cjej.js";import{u as Q}from"./util.service-DGlW4vEA.js";import{u as X}from"./useAsync-Dl5FScg5.js";import"./app-q0ws3Yx0.js";import"./useAsyncFn-DMoxp3xu.js";var b={},z=J.default,Z=H.default;Object.defineProperty(b,"__esModule",{value:!0});var D=b.default=void 0,v=Z(d),ee=z(U),se=z(G),re=function(s,i){var n={};for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.indexOf(o)<0&&(n[o]=s[o]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(s);l<o.length;l++)i.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(s,o[l])&&(n[o[l]]=s[o[l]]);return n};const oe=(s,i)=>{var{ellipsis:n}=s,o=re(s,["ellipsis"]);const l=v.useMemo(()=>n&&typeof n=="object"?(0,ee.default)(n,["expandable","rows"]):n,[n]);return v.createElement(se.default,Object.assign({ref:i},o,{ellipsis:l,component:"span"}))};D=b.default=v.forwardRef(oe);function te({data:s}){const{message:i}=N.useApp(),{address:n,connector:o}=C(),[l,u]=d.useState(!1),h=d.useCallback(async()=>{u(!0);try{const c=await R.cancelWithdrawRequestPortfolio(s.poolId,{chainId:K.chainId,tokenAddress:s.tokenAddress,userAddress:n});if(console.log("address",n,c),c.data){const y=await(await F()).send("cancelOrder",[{pool:s.poolAddress,noteTokenAddress:s.tokenAddress,maxTimestamp:c.maxTimestamp},`0x${c.data}`]),w=await Q.waitForTransactionReceipt(y,o==null?void 0:o.id);console.log(w),i.success("Withdraw request has been cancelled!");return}i.error("Cannot get signature")}catch(c){i.error(c.message||"Something went wrong!"),console.log({e:c})}u(!1)},[s.poolAddress,s.poolId,s.tokenAddress]);return e.jsx(O,{disabled:l,loading:l,onClick:h,children:"Cancel Withdraw"})}function ne({data:s,isOpen:i,onClose:n}){console.log(s);const o=s.isSot?"SOT":"JOT",{value:l}=X(async()=>{if(!s.poolAddress||!s.tokenAddress)return 0;const c=await q();try{const x=await c.methods.getTokenPrices([s.poolAddress],[s.tokenAddress]).call();return new T(x[0]||0).dividedBy(10**s.currencyDecimals).toNumber()}catch(x){return console.log(x),0}},[s.poolAddress,s.tokenAddress]),u=d.useMemo(()=>new T(s.size||0).minus(s.filledSize||0).dividedBy(10**s.currencyDecimals).toString(),[s.currencyDecimals,s.filledSize,s.size]),h=d.useMemo(()=>+u*l,[u,l]);return e.jsx(e.Fragment,{children:e.jsx(_,{width:"100vw",title:"Withdraw",open:i,onCancel:n,footer:null,children:e.jsx("div",{children:e.jsx("div",{style:{width:"100%",margin:"0px auto",marginBottom:50},children:e.jsxs("div",{style:{marginTop:20,padding:80,margin:"0 auto"},children:[e.jsx("div",{style:{fontSize:24,textAlign:"center",color:"black",marginBottom:30},children:e.jsx("b",{children:"Withdraw"})}),e.jsx(g,{style:{marginBottom:8},children:e.jsx(p,{xs:{span:16,offset:4},lg:{span:8,offset:8},children:e.jsx(g,{style:{marginBottom:8,marginTop:8},children:e.jsx(p,{xs:24,children:e.jsxs(j,{layout:"vertical",children:[e.jsx(j.Item,{label:"You are providing",extra:`${u} ${o}`}),e.jsx(j.Item,{label:"Youâ€™re expected to receive ",extra:`${h}`}),e.jsx(j.Item,{label:"Next distributed date",extra:s.endEpoch}),e.jsxs(P,{children:[e.jsx(D,{children:"I hereby acknowledge and agree to the Terms of Service, including:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Withdrawal requests are processed every 14 days, and it may take multiple distribution periods to fulfill the request."}),e.jsx("li",{children:"Withdrawal requests can be cancelled anytime before they are executed."})]})]}),e.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"space-between"},children:e.jsx(te,{data:s})})]})})})})})]})})})})})}function je(){const{address:s}=C(),[i,n]=d.useState([]),[o,l]=d.useState(!1),[u,h]=d.useState(!1),c=d.useCallback(()=>{h(!1)},[]),x=d.useCallback(()=>{h(!0)},[]),y=async()=>{var a,f,k,A,S;try{const t=await R.getWithdrawPortfolio(s),E=await q();let m=[];try{m=await E.methods.getTokenPrices((a=t==null?void 0:t.result)==null?void 0:a.map(r=>r==null?void 0:r.poolAddress),(f=t==null?void 0:t.result)==null?void 0:f.map(r=>r==null?void 0:r.tokenAddress)).call()}catch(r){console.log({e:r})}console.log((k=t==null?void 0:t.result)==null?void 0:k.map(r=>r==null?void 0:r.poolAddress),(A=t==null?void 0:t.result)==null?void 0:A.map(r=>r==null?void 0:r.tokenAddress),m);const I=(S=t==null?void 0:t.result)==null?void 0:S.map((r,M)=>({...r,displayPrice:`${Number(W(m[M]||0,r==null?void 0:r.currencyDecimals)).toFixed(2)} ${r==null?void 0:r.currencyName}`,size:W(r==null?void 0:r.size,r==null?void 0:r.currencyDecimals),endEpoch:$(r==null?void 0:r.endEpoch).format("DD/MM/YYYY HH:mm")}));n(I||[])}catch(t){console.log(t)}};d.useEffect(()=>{y()},[s]);const w=a=>{x(!0),l(a)},B=()=>i.map((a,f)=>e.jsxs(P,{children:[e.jsx(V,{menu:{items:[{key:"viewDetail",label:e.jsx("div",{onClick:()=>w(a),children:"View withdraw request"})}]},children:e.jsx(O,{size:"small",style:{position:"absolute",top:4,right:4},children:e.jsx(Y,{})})}),e.jsxs(g,{gutter:[12,0],children:[e.jsx(p,{xs:10,children:e.jsxs("div",{style:{fontWeight:500,fontSize:14},children:[e.jsx("span",{style:{color:"#1f244e"},children:a.poolName}),e.jsx("span",{style:{marginLeft:8},children:e.jsx(L,{color:"blue",children:a.isSot?"Senior":"Junior"})})]})}),e.jsx(p,{xs:6,children:e.jsxs("div",{style:{fontSize:14,textAlign:"center"},children:[e.jsxs("span",{style:{color:"#1f244e"},children:[a.isSot?"SOT":"JOT"," Withdrawal Amount"]}),e.jsx("div",{children:a.size})]})}),e.jsx(p,{xs:4,children:e.jsxs("div",{style:{fontSize:14,textAlign:"center"},children:[e.jsx("span",{style:{color:"#1f244e"},children:"Current Price"}),e.jsx("div",{children:a.displayPrice})]})}),e.jsx(p,{xs:4,children:e.jsxs("div",{style:{fontSize:14,textAlign:"center"},children:[e.jsx("span",{style:{color:"#1f244e"},children:"Next Distribution"}),e.jsx("div",{children:a.endEpoch})]})})]})]},f));return e.jsxs(g,{children:[e.jsx(p,{xxl:{span:16,offset:4},lg:{span:24,offset:0},children:B()}),e.jsx(ne,{data:o,isOpen:u,onClose:c})]})}export{je as default};
