import{a7 as t,j as e,ao as R,a9 as I,aJ as i,B as b,aQ as S,r as p,Y as x,aq as A,aD as O,bd as T,aY as z,aN as B,b9 as F,N as G}from"./vendor-WQejLG7Y.js";import{TabSelector as M}from"./index-BYRqIR4M.js";import{s as u}from"./scorecard.service-xSgAmy6z.js";import{u as v}from"./useAsyncFn-DMoxp3xu.js";import"./app-q0ws3Yx0.js";import"./fetchList-Dx9pDj27.js";import"./asset-psWvgQPY.js";import"./index-BUY2Cjej.js";import"./assetStatus-D1v3GkIP.js";import"./pool.service-DXigxJcB.js";import"./index-YDRpzjTi.js";import"./admin.service-hizXY1il.js";import"./batchStatus-CBLox09F.js";import"./AntdIcon-Bh4kV9XY.js";import"./index-BwXrazuH.js";const E=({isOpen:r,defaultValue:c,onClose:m,onSave:a,loading:d})=>{const h=S(c),[y]=t.useForm(),l=[{required:!0,message:"This field is required"}];return e.jsx(R,{title:e.jsx("h2",{className:"m-0 font-semibold leading-6 text-lg",children:h?"Add a risk score":"Update risk score"}),centered:!0,open:r,onCancel:m,footer:null,children:e.jsx("div",{className:"mt-9 [&_label]:!h-4 [&_label]:!leading-0 [&_.ant-form-item]:!leading-4 rounded-3xl",children:e.jsxs(t,{onFinish:f=>a({...c,...f}),form:y,initialValues:{...c},size:"large",layout:"vertical",requiredMark:!1,children:[e.jsx(t.Item,{rules:[...l,{message:"Max 5 characters",max:5}],name:"name",label:"Risk Score",children:e.jsx(I,{})}),e.jsx("div",{className:"w-full bg-[#252726] h-[1px] opacity-[0.08] my-4"}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"daysPastDue",label:"Days past due",children:e.jsx(i,{className:"w-full",min:0,suffix:"days",controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"advanceRate",label:"Advance rate",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"interestRate",label:"Interest rate",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"penaltyRate",label:"Penalty rate",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"gracePeriod",label:"Grace period",children:e.jsx(i,{className:"w-full",suffix:"days",min:0,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"collectionPeriod",label:"Collection Period",children:e.jsx(i,{className:"w-full",suffix:"days",min:0,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"writeOffAfterGracePeriod",label:"Write off after grace period",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,name:"writeOffAfterCollectionPeriod",label:"Write off after collection period",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsx("div",{className:"w-full bg-[#252726] h-[1px] opacity-[0.08] my-4"}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"probabilityOfDefault",label:"Probability of default (Annual)",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsx(t.Item,{rules:l,rootClassName:"mb-4",name:"lossGivenDefault",label:"Loss given default",children:e.jsx(i,{className:"w-full",suffix:"%",min:0,max:100,precision:2,controls:!1})}),e.jsxs("div",{className:"flex justify-end items-center gap-2",children:[e.jsx(b,{size:"large",className:"!rounded-full w-24 bg-[#25272614] hover:bg-[#25272614]",onClick:m,disabled:d,children:"Cancel"},"back"),e.jsx(b,{size:"large",loading:d,className:"border-none !rounded-full w-24 ",type:"primary",htmlType:"submit",children:"Save"},"submit")]})]})})})},q=()=>{const[r,c]=p.useState(0),[{loading:m,value:a=[]},d]=v(async s=>{var o;const n=await u.getScorecards(s);for(const P of n)delete P.children;return c(((o=n[0])==null?void 0:o.discountRate)??""),n}),[{loading:h},y]=v(async()=>{await Promise.all(a.map(s=>u.updateScoreCard({...s,discountRate:r}))),await d()},[a,r]),[l,f]=p.useState({isOpen:!1,defaultValue:void 0}),w=s=>{f({isOpen:!0,defaultValue:s})},j=()=>{f({isOpen:!1,defaultValue:void 0})},g=async s=>{await u.deleteScorecard(s.id),await d(),x.success("Delete risk score successfully")},[{loading:C},k]=v(async s=>{if(!s)return;const n=!(s!=null&&s.id);if(n&&a.find(o=>o.daysPastDue==s.daysPastDue&&o.name!=s.name)){x.error("Days past due already exists");return}n?(await u.createScoreCard({...s,discountRate:r}),x.success("Add new risk score successfully")):(await u.updateScoreCard({...s,discountRate:r}),x.success("Update risk score successfully")),await d(),j()},[r,a,j,d]);p.useEffect(()=>{d()},[]);const D=[{key:"name",title:"Risk score",dataIndex:"name"},{title:"Days past due",dataIndex:"daysPastDue",key:"daysPastDue",render:(s,n,o)=>o===a.length-1?`≥ ${s}`:`${s} ≤ ${a[o+1].daysPastDue}`},{title:"Advance rate",dataIndex:"advanceRate",key:"advanceRate"},{title:"Interest rate",dataIndex:"interestRate",key:"interestRate"},{title:"Probability of default",dataIndex:"probabilityOfDefault",key:"probabilityOfDefault"},{title:"Loss given default",dataIndex:"lossGivenDefault",key:"lossGivenDefault"},{title:"",dataIndex:"",render:(s,n)=>e.jsx("div",{className:"flex justify-end invisible group-hover:visible",children:e.jsxs("div",{className:"w-min flex justify-between gap-6 bg-[#CECFCF] rounded-md px-4 py-2 my-0",children:[e.jsx("a",{onClick:()=>{const o=T(n,["id","name","daysPastDue","advanceRate","interestRate","discountRate","penaltyRate","gracePeriod","collectionPeriod","writeOffAfterGracePeriod","writeOffAfterCollectionPeriod","probabilityOfDefault","lossGivenDefault"]);w(o)},className:"rounded-sm shadow-none font-semibold text-[#117B37]",type:"primary",children:"Update"}),e.jsx(z,{overlayClassName:"!w-36",onConfirm:()=>g(n),title:"Are you sure want to delete?",okText:"OK",cancelText:"Cancel",icon:null,okButtonProps:{shape:"round",className:"shadow-none border-none !font-medium"},arrow:!1,placement:"top",cancelButtonProps:{shape:"round",className:"shadow-none font-normal !font-medium",style:{backgroundColor:"#25272614"}},children:e.jsx("a",{className:"font-semibold text-[#CB3A3A] hover:text-[#CB3A3A]",children:"Delete"})})]})})}];return e.jsxs("div",{className:"flex flex-col items-stretch [&_.ant-table-row-level-1]:!bg-[#f0f0f0] relative",children:[e.jsxs("div",{className:"flex items-end gap-4 absolute z-10 -top-[86px] self-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Discount Rate"}),e.jsxs(A.Compact,{children:[e.jsx(i,{value:+r,onChange:s=>c(s),className:"w-[196px]",size:"large",precision:2,suffix:"%",min:0,controls:!1}),e.jsx(b,{loading:h,size:"large",onClick:y,children:"Save"})]})]}),e.jsx(b,{type:"primary",size:"large",className:"!rounded-full",onClick:()=>w(),children:"Add a risk score"})]}),e.jsx(O,{columns:D,pagination:!1,loading:m,dataSource:a,rowClassName:"group"}),(l==null?void 0:l.isOpen)&&e.jsx(E,{...l,onClose:j,onSave:k,loading:C})]})},N=[{label:"Risk Score",value:"risk-score",Content:q}],ae=()=>{const[r,c]=p.useState(B(N).value),m=N.find(a=>a.value===r);return e.jsxs("div",{className:"max-w-[1416px] mx-auto space-y-6",children:[e.jsx("h1",{className:"m-0 text-4xl",children:"Templates"}),e.jsx("div",{className:"w-full bg-[#252726] h-[1px] opacity-[0.08]"}),e.jsx("div",{className:"flex justify-between",children:e.jsx("nav",{className:"flex border-gray-300 items-center",children:N.map(a=>e.jsx(G,{to:`/templates/${a.value}`,children:e.jsx(M,{isActive:r===a.value,onClick:()=>c(a.value),children:a.label})},a.value))})}),F.createElement(m.Content??null)]})};export{ae as default};
